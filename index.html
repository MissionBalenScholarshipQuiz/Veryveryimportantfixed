<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Balen Scholarship - Prep Portal</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone@7.24.7/babel.min.js"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:wght@700&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
    <!-- html2canvas for downloads -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; background-color: #f8fafc; background-image: radial-gradient(circle at 1px 1px, #e2e8f0 1px, transparent 0); background-size: 20px 20px; }
        .dark body { background-color: #020617; background-image: radial-gradient(circle at 1px 1px, #1e293b 1px, transparent 0); }
        .font-serif { font-family: 'Playfair Display', serif; }
        .font-script { font-family: 'Dancing Script', cursive; letter-spacing: 0.5px; }
        @keyframes gradient-animation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .animate-gradient { background-size: 400% 400%; animation: gradient-animation 15s ease infinite; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.6s ease-out forwards; }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slideInUp { animation: slideInUp 0.5s ease-out forwards; }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .animate-popIn { animation: popIn 0.4s ease-out; }
        @keyframes tada { from {transform: scale3d(1, 1, 1);} 10%, 20% {transform: scale3d(.9, .9, .9) rotate3d(0, 0, 1, -3deg);} 30%, 50%, 70%, 90% {transform: scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg);} 40%, 60%, 80% {transform: scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg);} to {transform: scale3d(1, 1, 1);} }
        .animate-tada { animation: tada 1s ease-in-out; }
        .glassmorphism { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .dark .glassmorphism { background: rgba(15, 23, 42, 0.2); border-color: rgba(51, 65, 85, 0.5); }
        .gradient-button { background: linear-gradient(45deg, #4f46e5, #9333ea); transition: all .3s ease; }
        .gradient-button:hover:not(:disabled) { transform: translateY(-3px) scale(1.03); box-shadow: 0 10px 25px rgba(79,70,229,.4); }
        .gradient-button:disabled { background: #9ca3af; cursor: not-allowed; }
        .card-hover { transition: transform .3s ease, box-shadow .3s ease; }
        .card-hover:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 25px 40px -12px rgba(0,0,0,.15); }
        .nav-button.active { background: linear-gradient(45deg, #4338ca, #7e22ce); box-shadow: 0 6px 18px rgba(79,70,229,.45); transform: translateY(-2px); }
        .quiz-progress-bar { height: 12px; border-radius: 6px; background-color: #e5e7eb; overflow: hidden; }
        .dark .quiz-progress-bar { background-color: #374151; }
        .quiz-progress-fill { height: 100%; background: linear-gradient(45deg, #22c55e, #84cc16); border-radius: 6px; transition: width .5s ease-in-out; }
        .overlay { position: fixed; inset: 0; background-color: rgba(0,0,0,.7); display: flex; justify-content: center; align-items: center; z-index: 1000; padding: 1rem; backdrop-filter: blur(4px); animation: fadeIn 0.3s ease; }
        .modal-box { padding: 2rem; border-radius: 1rem; box-shadow: 0 20px 40px rgba(0,0,0,.3); text-align: center; color: #111827; animation: popIn .4s ease-out; max-width: 95%; width: 500px; max-height: 90vh; overflow-y: auto; }
        .dark .modal-box { color: #f3f4f6; }
        .pdf-viewer-modal { background: #111827; padding: 0; border-radius: .75rem; overflow: hidden; width: 95vw; height: 90vh; max-width: 1200px; display: flex; flex-direction: column; position: relative; }
        .pdf-viewer-modal .header { padding: .75rem 1.5rem; background: #262626; display:flex; justify-content: space-between; align-items: center; }
        .pdf-viewer-modal .header h3 { font-weight: bold; color: white; }
        .pdf-viewer-modal .close-button { background: rgba(255,255,255,.2); color: white; border: none; border-radius: 9999px; width: 32px; height: 32px; display: grid; place-items: center; font-size: 1.1rem; cursor: pointer; z-index: 1001; }
        .nav-button-notify::after { content: ''; position: absolute; top: 0.5rem; right: 0.5rem; width: 8px; height: 8px; border-radius: 50%; background-color: #ef4444; border: 1px solid white; }
        @keyframes confetti-fall { 0% { transform: translateY(-100%) rotateZ(0deg); } 100% { transform: translateY(100vh) rotateZ(720deg); } }
        .confetti { position: absolute; width: 10px; height: 10px; opacity: 0.7; animation: confetti-fall 5s linear infinite; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-slate-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">
    <div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useMemo, Fragment, useCallback, useRef } = React;

    // =================================================================================
    // ===== ALL EDITABLE DATA IS IN THIS OBJECT =====
    // =================================================================================
    const DATA = {
        whatsAppContactNumber: "9826594548",
        premiumInfoVideoLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ', // Placeholder link
        premiumPrice: 199,
        esewaId: "9863997295",
        XP_PER_QUIZ: 10,
        XP_PER_LEVEL: 100,
        XP_PER_BRAIN_BREAK: 5,
        STREAK_UNLOCKS: { 7: 2, 14: 5, 30: 10 },
        validSymbolNumbers: ['S001', 'S002', 'S003', '021052854', '04803820', 'S004', 'S005', '03607811', '4444', '7777', 'S006', 'S007', 'S008', 'S009', 'S010'],
       dailyQuizzes: [
                { day: 1, subject: "Mixed", title: "Mixed Subject Challenge", link: "https://ganeshdahal-hue.github.io/mix/", isPremium: false },
                { day: 2, subject: "Science", title: "Physics Practice Test", link: "https://ganeshdahal-hue.github.io/physis/", isPremium: false },
                { day: 3, subject: "English", title: "Grammar Essentials", link: "https://ganeshdahal-hue.github.io/english/", isPremium: false },
                { day: 4, subject: "GK", title: "World Geography", link: "https://ganeshdahal-hue.github.io/GK/", isPremium: false },
                { day: 5, subject: "Science", title: "Physics Fundamentals", link: "https://ganeshdahal-hue.github.io/physic/", isPremium: false },
                { day: 6, subject: "Math", title: "Geometry Challenge", link: "https://ganeshdahal-hue.github.io/mathematic/", isPremium: false },
                { day: 7, subject: "English", title: "Vocabulary Boost", link: "https://ganeshdahal-hue.github.io/english-set/", isPremium: false },
                { day: 8, subject: "GK", title: "History Trivia", link: "https://ganeshdahal-hue.github.io/GKK-/", isPremium: false },
                { day: 9, subject: "Science", title: "Biology Essentials", link: "https://ganeshdahal-hue.github.io/chemistry/", isPremium: true },
                { day: 10, subject: "English", title: "Reading Comprehension", link: "https://ganeshdahal-hue.github.io/grammar/", isPremium: false },
                { day: 11, subject: "GK", title: "Science Trivia", link: "https://ganeshdahal-hue.github.io/GK-2/", isPremium: false },
                { day: 12, subject: "Science", title: "Physics Advanced", link: "https://ganeshdahal-hue.github.io/physicscience-/", isPremium: false },
                { day: 13, subject: "Scholarship", title: "Scholarship Strategies", link: "https://ganeshdahal-hue.github.io/scholarship-/", isPremium: false },
                { day: 14, subject: "Scholarship", title: "Balen Exam Insights", link: "https://ganeshdahal-hue.github.io/balenscholar/", isPremium: false },
                { day: 15, subject: "Scholarship", title: "Balen Prep Challenge", link: "https://ganeshdahal-hue.github.io/balenscholarshipp/", isPremium: true },
                { day: 16, subject: "Mixed", title: "General Knowledge Mastery", link: "https://ganeshdahal-hue.github.io/GKK/", isPremium: true },
                { day: 17, subject: "Scholarship", title: "Mixed Subject Challenge", link: "https://ganeshdahal-hue.github.io/Balen-quizz-/", isPremium: true },
                { day: 18, subject: "Scholarship", title: "Balen Success Guide", link: "https://ganeshdahal-hue.github.io/balenganesh/", isPremium: true },
                { day: 19, subject: "Science", title: "Biology Deep Dive", link: "https://ganeshdahal-hue.github.io/biology-deep-dive/", isPremium: true },
                { day: 20, subject: "Mixed", title: "Knowledge Booster", link: "https://ganeshdahal-hue.github.io/newwquiz/", isPremium: true },
                { day: 21, subject: "Mixed", title: "Ultimate Trivia", link: "https://ganeshdahal-hue.github.io/newquizz-/", isPremium: true },
                { day: 22, subject: "Mixed", title: "Daily Brain Challenge", link: "https://ganeshdahal-hue.github.io/todayquiz/", isPremium: true },
                { day: 23, subject: "Mixed", title: "Biology Bonus", link: "https://ganeshdahal-hue.github.io/biology-bonus/", isPremium: true },
                { day: 24, subject: "Mixed", title: "All-Round Quiz", link: "https://ganeshdahal-hue.github.io/newwquizzz/", isPremium: true },
                { day: 25, subject: "Mixed", title: "Scholarship Prep Quiz", link: "https://ganeshdahal-hue.github.io/ganeshquiz/", isPremium: true },
                { day: 26, subject: "Mixed", title: "Comprehensive Quiz", link: "https://ganeshdahal-hue.github.io/newquizall/", isPremium: true },
                { day: 27, subject: "Mixed", title: "Grand Final Quiz", link: "https://ganeshdahal-hue.github.io/new-quiz/", isPremium: true },
                { day: 28, subject: "Mixed", title: "Ultimate Challenge Quiz", link: "https://ganeshdahal-hue.github.io/newquizzzzzzzz/", isPremium: true },
                { day: 29, subject: "Mixed", title: "General Knowledge Quiz 1", link: "https://ganeshdahal-hue.github.io/newquiz1/", isPremium: true },
                { day: 30, subject: "Mixed", title: "General Knowledge Quiz 2", link: "https://ganeshdahal-hue.github.io/newquiz-2-/", isPremium: true },
                { day: 31, subject: "Mixed", title: "General Knowledge Quiz 3", link: "https://ganeshdahal-hue.github.io/newquiz3/", isPremium: true },
                { day: 32, subject: "Mixed", title: "General Knowledge Quiz 4", link: "https://ganeshdahal-hue.github.io/newquiz4/", isPremium: true },
                { day: 33, subject: "English", title: "Grammar Mastery Quiz", link: "https://ganeshdahal-hue.github.io/grammarquiz/", isPremium: true },
                { day: 34, subject: "Science", title: "Science MCQs Challenge", link: "https://ganeshdahal-hue.github.io/sciencemcqs45/", isPremium: true },
                { day: 35, subject: "Scholarship", title: "Scholarship Exam Prep", link: "https://ganeshdahal-hue.github.io/balenscholarshipp/", isPremium: true },
                { day: 36, subject: "Scholarship", title: "Scholarship Mastery", link: "https://ganeshdahal-hue.github.io/balenscholarships/", isPremium: true }
            ],
            resources: [
                { category: "Premium Materials", items: [
                    { title: "Bridge Course Book", link: "https://drive.google.com/file/d/1lUuQUNbDakJIGCUPdDJ4Dt9z_iBNxf07/view?usp=sharing", tags: ['book', 'core'] },
                    { title: "Advance Mathematics Book", link: "https://drive.google.com/file/d/1DpIqrtanBnn5cWdXPCY6c18NdtnwKGRl/view?usp=sharing", tags: ['book', 'math'] },
                    { title: "Mathematics Book", link: "https://drive.google.com/file/d/1yfgpjpx9nIQAn9bpkB9CN2KnWJAWRbuU/view?usp=drive_link", tags: ['book', 'math'] },
                    { title: "Saint Xavier 20 Practice Set", link: "https://drive.google.com/drive/folders/1AnPNaUzF69Ctqk5nz_j0WPPn2ThMV4ui?usp=drive_link", tags: ['practice-set', 'st-xavier'] },
                    { title: "Saint Xavier Past Year Question", link: "https://drive.google.com/file/d/1XBcSL3UYqlrdqnJlQ_VIdKb8mRjXAluE/view?usp=sharing", tags: ['past-paper', 'st-xavier'] },
                    { title: "Saint Xavier Part 2", link: "https://drive.google.com/file/d/1-ZfsuTCMjGolTbS0omu1Wo7Wdaj_3TXO/view", tags: ['practice-set', 'st-xavier'] },
                    { title: "Top 300 MCQs", link: "https://drive.google.com/file/d/1wakykGdveh3O5EN7y05DUChBKYs9HW3V/view?usp=sharing", tags: ['mcq', 'mixed'] },
                    { title: "Grammar Book", link: "https://drive.google.com/file/d/1uAVP1zG21d8To6SeLuQT_2L_A_8R7L5m/view?usp=drive_link", tags: ['book', 'english'] },
                    { title: "Fix MCQs Sets", link: "https://drive.google.com/drive/folders/1izAJI6A4par4qM0c5q-jjiZvWK2xRF9z?usp=drive_link", tags: ['mcq', 'mixed'] },
                    { title: "New MCQs Set", link: "https://drive.google.com/drive/folders/1YiFTUm5HYyeIqeCYPw_yBsmfaV91a8JP?usp=drive_link", tags: ['mcq', 'mixed'] },
                    { title: "Science All Chapter Notes", link: "https://drive.google.com/drive/folders/1t5JGigm1OkFJ9T64IEMuVqR1a_FEutkI?usp=drive_link", tags: ['notes', 'science'] },
                    { title: "Grammar Tips", link: "https://drive.google.com/drive/folders/1yfCKCdSrWORe6ZV0yJiLwLFBI5xZGt5-?usp=drive_link", tags: ['notes', 'english'] },
                    { title: "Science chapter wise MCQs", link: "https://drive.google.com/file/d/1eazkSqbO_J6PanBj7-sPdzMDd-uEuR3j/view?usp=sharing", tags: ['mcq', 'science'] },
                    { title: "Entrance Question", link: "https://drive.google.com/file/d/1aACIunJxfDtSeQdAAU-vXhwUMxp78Jky/view?usp=drive_link", tags: ['past-paper', 'balen'] },
                    { title: "Special Book for Balen Scholarship", link: "https://drive.google.com/file/d/1EPjk91zWWl-OHOqawwvJJhnHma9RveE7/view?usp=sharing", tags: ['book', 'balen'] },
                    { title: "Grammar MCQs", link: "https://drive.google.com/file/d/1A3-Hlv1dmh9aSrqNxms3qP-upFEJ6nCg/view?usp=drive_link", tags: ['mcq', 'english'] },
                    { title: "Balen Entrance qn 2082", link: "https://drive.google.com/file/d/1aACIunJxfDtSeQdAAU-vXhwUMxp78Jky/view?usp=drive_link", tags: ['past-paper', 'balen'] },
                    { title: "Daily Updated PDF", link: "https://drive.google.com/drive/folders/1NQFdxJ0uYwOMpVcD-TKFZ4-zB5Xb70Ru?usp=sharing", tags: ['pdf', 'daily'] },
                ]},
                { category: "Free Resources", items: [
                    { title: "Daily Updated PDF", link: "https://drive.google.com/drive/folders/1On-EmwuZ6yyRFKixIneRA9ZjLsX_ally?usp=drive_link", tags: ['pdf', 'daily'] },
                    { title: "Sample Questions", link: "https://drive.google.com/file/d/1DksWWHY6JQUFzOy2Jv97HPlsgD0WNHVo/view?usp=drive_link", tags: ['mcq', 'mixed'] },
                    { title: "SEE Gear Up Book", link: "https://drive.google.com/file/d/1uypKarUcoYgDnD0pISv96-8r9UTKhU6O/view?usp=sharing", tags: ['book', 'core'] },
                    { title: "Model Questions 1", link: "https://drive.google.com/file/d/1vs5IwyLGL_h1WtpfkMUrlEicz2lbUtZ/view?usp=drive_link", tags: ['model-paper', 'mixed'] },
                    { title: "Model Questions 2", link: "https://drive.google.com/file/d/1VEmPFVN_ZruogYemjKFv5Pw5tb_RL25X/view?usp=drive_link", tags: ['model-paper', 'mixed'] },
                    { title: "Model Questions 3", link: "https://drive.google.com/file/d/1bFB8XA_SqYgBLvR-biEw1OLJwjJDB4UY/view?usp=drive_link", tags: ['model-paper', 'mixed'] },
                    { title: "Model Questions 4", link: "https://drive.google.com/file/d/1qJvS-MFKSsbI_Vye-sv45kbEtjQo4SSY/view?usp=drive_link", tags: ['model-paper', 'mixed'] },
                    { title: "Model Questions 5", link: "https://drive.google.com/file/d/1nK1474vztSurABVBiH-EwtwiwTLMgNrI/view?usp=drive_link", tags: ['model-paper', 'mixed'] },
                    { title: "Model Questions 6", link: "https://drive.google.com/file/d/1nK1474vztSurABVBiH-EwtwiwTLMgNrI/view?usp=drive_link", tags: ['model-paper', 'mixed'] },
                    { title: "Model Questions 7", link: "https://drive.google.com/file/d/1m_RMONzS7jPTm2i3sTc9VopsEAIIkbsK/view?usp=drive_link", tags: ['model-paper', 'mixed'] },
                    { title: "Model Questions 8", link: "https://drive.google.com/file/d/1zDsA2krNOYrm5XNzOu-kLavS4U_0iatl/view?usp=drive_link", tags: ['model-paper', 'mixed'] },
                    { title: "Model Questions 9", link: "https://drive.google.com/file/d/1_IbfFZmISnOScLtJofMr4fjGli50bUyy/view?usp=drive_link", tags: ['model-paper', 'mixed'] },
                    { title: "Model Questions 11", link: "https://drive.google.com/file/d/1gi6njpTeM-JNYRm7ezkBxFQpJDbkMib-/view?usp=drive_link", tags: ['model-paper', 'mixed'] },
                    { title: "Grammar MCQs", link: "https://drive.google.com/file/d/1qJvS-MFKSsbI_Vye-sv45kbEtjQo4SSY/view?usp=drive_link", tags: ['mcq', 'english'] },
                    { title: "Grammar Test", link: "https://drive.google.com/file/d/1izVfscX_5NsvSEKruqL_V6Tskep_mFt-/view?usp=sharing", tags: ['test', 'english'] },
                    { title: "Subject Verb Agreement", link: "https://drive.google.com/file/d/11B2nCMqTkVdGdDoA5euQruKyqIpNjoCO/view?usp=sharing", tags: ['notes', 'english'] },
                    { title: "Saint Xavier College", link: "https://drive.google.com/file/d/1KWIusQPq2Q6pgzshH93tZZwx3K58ibZw/view?usp=sharing", tags: ['past-paper', 'st-xavier'] },
                    { title: "Saint Xavier CLZ 2", link: "https://www.facebook.com/share/p/19igTfRAwo/", tags: ['past-paper', 'st-xavier'] },
                    { title: "KIST College", link: "https://www.facebook.com/share/p/1CErQbwi43/", tags: ['past-paper', 'kist'] },
                    { title: "GK MCQs", link: "https://drive.google.com/file/d/1Jq-lg3gqcuKfFEriodQmTM8pvpKpTSeX/view?usp=drive_link", tags: ['mcq', 'gk'] },
                    { title: "Practice question", link: "https://drive.google.com/file/d/1FL6Yuz4byhfSM-1HP7_NKNTQzV3TNerf/view?usp=drive_link", tags: ['practice-set', 'mixed'] },
                    { title: "KIST college model Question", link: "https://drive.google.com/file/d/1tDrJsd4LqmE2lETvTzMjBmDAE6zJ8qmO/view?usp=drive_link", tags: ['past-paper', 'kist'] },
                    { title: "Idiom and phrases", link: "https://drive.google.com/file/d/1O_34SqIb01li2MgYNPUeY6K_E_zTbqQO/view?usp=drive_link", tags: ['notes', 'english'] },
                    { title: "All subject MCQs", link: "https://drive.google.com/file/d/1Aqz8fcIMbHqgoHJZScUchDWV2P3Vv7OA/view?usp=sharing", tags: ['mcq', 'mixed'] },
                ]}
            ],
            videos: [
                { title: "All About Balen Exam", link: "#" },
                { title: "How to Fill Balen Scholarship Form", link: "#" },
                { title: "How to Check SEE Result", link: "#" },
                { title: "Balen Exam Tips", link: "#" },
            ],
            notices: [
                { id: 3, title: "New Video Guide Added just for you", date: "August 2, 2024", content: "We've added a new video guide on exam strategies. <a href='https://www.youtube.com' target='_blank' rel='noopener noreferrer' class='text-blue-500 hover:underline'>Click here to watch!</a>", type: "Update" },
                { id: 2, title: "Weekly Quiz Competition Schedule", date: "July 28, 2024", content: "Our weekly live quiz competition will now be held every Monday, Wednesday, and Saturday at 8:00 PM.", type: "Announcement" },
                { id: 1, title: "Form Submission Deadline Approaching", date: "July 25, 2024", content: "Please remember that the deadline for the official Balen Scholarship form submission is approaching.", type: "Important" },
                 { id: 7, title: "Welcome To our Portal", date: "October 2, 2024", content: "Thank You for choosing us <a href='#' class='text-blue-500 hover:underline'>Click for details.</a>", type: "Important", isCompulsory: true },
            ],
        faqs: [ { category: "Eligibility & General", items: [
                    { question: "Who can apply for the scholarship?", answer: "Any student who passed SEE with at least 1.6 GPA from either a community or institutional school in Nepal. Priority is given to community school students, underrepresented groups, and those with financial need." },
                    { question: "Do I need to be from Kathmandu, or can students from other districts apply?", answer: "Yes, students from all over Nepal can apply. However, priority is given to students studying in schools under Kathmandu Metropolitan City." },
                    { question: "Is this exam the same as +2 college admission entrance exams?", answer: "No. This is a separate scholarship entrance exam conducted by Kathmandu Metropolitan City, not a general college admission exam." },
                    { question: "What is the minimum GPA required in SEE to be eligible?", answer: "The minimum eligibility requirement is a GPA of 1.6 or above in the SEE examination." },
                    { question: "Is there any age limit for applying?", answer: "No specific age limit is mentioned. The exam is primarily intended for recent SEE graduates applying for +2 (Science, Management, Humanities, or Law)." },
                ]},
                { category: "Application Process", items: [
                    { question: "What documents do I need to apply?", answer: (<div><p>You need:</p><ul className="list-disc pl-5"><li>SEE Admit Card & Marksheet</li><li>Passport-sized photo</li><li>Citizenship or birth certificate</li><li>School recommendation letter</li></ul></div>) },
                    { question: "How do I apply online, and what if the portal doesn’t work?", answer: (<div><p>You must apply through <a href="https://entrance.kathmandu.gov.np" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">entrance.kathmandu.gov.np</a>. If the portal is slow, try during off-peak hours. For issues, contact the KMC Education Department.</p></div>) },
                    { question: "Do I need to pay any fee to apply?", answer: "No, the application is completely free of cost." },
                    { question: "Can I apply offline if I face issues online?", answer: "No. The process is fully online. There is no offline submission option." },
                ]},
                { category: "Exam Details", items: [
                    { question: "What is the exam syllabus — Grade 10 only, or also Grade 11 topics?", answer: "The exam is strictly based on the Grade 10 (SEE) syllabus. No Grade 11 content is included." },
                    { question: "How many questions are there, and how much time do we get?", answer: "There are 100 multiple-choice questions (MCQs). The duration of the exam is 2 hours." },
                    { question: "Is there negative marking in the exam?", answer: "No, there is no negative marking. Wrong answers do not reduce your score." },
                    { question: "Are calculators or mobile phones allowed during the exam?", answer: "No, electronic devices like calculators, smart watches, or mobile phones are not allowed inside the exam hall." },
                ]},
                { category: "Results & Scholarships", items: [
                    { question: "How are results published, and how do I know if I’m selected?", answer: "Results are published as merit lists on the official KMC portal (kathmandu.gov.np). Students must check their roll number and rank to know if they are selected." },
                    { question: "Does the scholarship cover all expenses (books, uniforms, hostel), or only tuition fees?", answer: "The scholarship covers full or partial tuition fees in affiliated colleges. It does not cover additional costs like books, uniforms, or hostel fees." },
                ]}
            ],
        competitionResults: {
            date: "August 12, 2024", // **IMPORTANT**: Change this date to trigger new certificates for winners.
            podium: [{ rank: 1, name: "Ganesh Dahal", symbol: "S002", score: "98%", img: "https://raw.githubusercontent.com/ganeshdahal-HUE/practicece/6684a6cfa40eda8be7402689857a23575f0b723a/494645815_122099085086862980_1698079942897814974_n.jpg", medal: '🏆', color: 'amber' },{ rank: 2, name: "Alex Johnson", symbol: "S003", score: "95%", img: "https://i.pravatar.cc/150?u=alex", medal: '🥈', color: 'slate' },{ rank: 3, name: "John Doe", symbol: "S001", score: "92%", img: "https://i.pravatar.cc/150?u=john", medal: '🥉', color: 'orange' }],
            table: [{ rank: 4, name: "Player 4", symbol: "S004", score: "88%" },{ rank: 5, name: "Player 5", symbol: "S005", score: "85%" }]
        },
        leaderboardData: [
            { rank: 1, name: "Ganesh Dahal", symbol: "S002", score: 1850, medal: '🏆' },
            { rank: 2, name: "Alex Johnson", symbol: "S003", score: 1720, medal: '🥈' },
            { rank: 3, name: "John Doe", symbol: "S001", score: 1680, medal: '🥉' },
            { rank: 4, name: "Player 4", symbol: "S004", score: 1550 },
            { rank: 5, name: "Player 5", symbol: "S005", score: 1490 },
            { rank: 6, name: "Sarah Connor", symbol: "S006", score: 1450 },
            { rank: 7, name: "Mike Ross", symbol: "S007", score: 1380 },
            { rank: 8, name: "Hello", symbol: "021052854", score: 1350 },
            { rank: 9, name: "Jessica Pearson", symbol: "S008", score: 1290 },
            { rank: 10, name: "Harvey Specter", symbol: "S009", score: 1250 }
        ],
        entertainment: {
            brainTeasers: [
                { question: "Which planet is known as the Red Planet?", options: ["Earth", "Mars", "Jupiter", "Saturn"], correctAnswer: "Mars" },
                { question: "What is the capital of France?", options: ["London", "Berlin", "Paris", "Madrid"], correctAnswer: "Paris" },
                { question: "What is H2O in chemistry?", options: ["Hydrogen", "Oxygen", "Water", "Salt"], correctAnswer: "Water" },
                { question: "Which animal is known as the 'King of the Jungle'?", options: ["Tiger", "Elephant", "Lion", "Bear"], correctAnswer: "Lion" },
                { question: "How many continents are there in the world?", options: ["5", "6", "7", "8"], correctAnswer: "7" },
                { question: "What is the largest mammal in the world?", options: ["Elephant", "Blue Whale", "Giraffe", "Shark"], correctAnswer: "Blue Whale" },
                { question: "Who wrote 'Romeo and Juliet'?", options: ["Charles Dickens", "William Shakespeare", "Jane Austen", "Mark Twain"], correctAnswer: "William Shakespeare" },
                { question: "What is the square root of 81?", options: ["7", "8", "9", "10"], correctAnswer: "9" },
                { question: "In which country are the Pyramids of Giza located?", options: ["Greece", "Italy", "Egypt", "Mexico"], correctAnswer: "Egypt" },
                { question: "What gas do plants absorb from the atmosphere?", options: ["Oxygen", "Nitrogen", "Carbon Dioxide", "Hydrogen"], correctAnswer: "Carbon Dioxide" }
            ],
            motivationalQuotes: [
                { quote: "The secret of getting ahead is getting started.", author: "Mark Twain" },
                { quote: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
                { quote: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
                { quote: "Strive not to be a success, but rather to be of value.", author: "Albert Einstein" }
            ],
            riddles: [
                { riddle: "I speak without a mouth and hear without ears. What am I?", answers: ["an echo", "echo"] },
                { riddle: "What has an eye, but cannot see?", answers: ["a needle", "needle"] },
                { riddle: "What has keys, but opens no locks?", answers: ["a piano", "piano", "a keyboard", "keyboard"] },
                { riddle: "What comes once in a minute, twice in a moment, but never in a thousand years?", answers: ["the letter m", "letter m", "m"] },
                { riddle: "I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?", answers: ["a map", "map"] },
                { riddle: "What has to be broken before you can use it?", answers: ["an egg", "egg"] }
            ]
        },
        achievementsList: {
            FIRST_QUIZ: { id: 'FIRST_QUIZ', title: 'First Step', icon: 'fas fa-shoe-prints', description: 'Complete your very first daily quiz.' },
            ALL_QUIZZES: { id: 'ALL_QUIZZES', title: 'Course Complete', icon: 'fas fa-trophy', description: 'Successfully complete all daily quizzes.', hasCertificate: true },
            STREAK_7: { id: 'STREAK_7', title: 'Dedicated Scholar', icon: 'fas fa-fire-alt', description: 'Maintain a 7-day login streak.' },
            STREAK_14: { id: 'STREAK_14', title: 'Habit Builder', icon: 'fas fa-calendar-check', description: 'Maintain a 14-day login streak.' },
            STREAK_30: { id: 'STREAK_30', title: 'Portal Legend', icon: 'fas fa-crown', description: 'Maintain a 30-day login streak.' },
            BRAIN_ACADEMY: { id: 'BRAIN_ACADEMY', title: 'Brain Academy', icon: 'fas fa-brain', description: 'Complete a brain teaser and a riddle in one day.' },
            THREE_WINS: { id: 'THREE_WINS', title: 'Podium Pro', icon: 'fas fa-medal', description: 'Achieve a top 3 position in the quiz competition 3 times.' },
            PREMIUM_USER: { id: 'PREMIUM_USER', title: 'Premium Supporter', icon: 'fas fa-star', description: 'Unlock premium access to support the portal.', hasCertificate: true }
        },
    };

    // =================================================================================
    // ===== HELPER FUNCTIONS & REUSABLE UI COMPONENTS =====
    // =================================================================================
    const getJSONFromLocalStorage = (key, defaultValue) => { try { const item = localStorage.getItem(key); return item ? JSON.parse(item) : defaultValue; } catch (error) { console.error(`Error with localStorage key "${key}":`, error); return defaultValue; } };
    const getIconForResource = (tags) => { if (!tags) return 'fas fa-file-alt'; if (tags.includes('book')) return 'fas fa-book-open'; if (tags.includes('math')) return 'fas fa-calculator'; if (tags.includes('english')) return 'fas fa-spell-check'; if (tags.includes('science')) return 'fas fa-flask'; if (tags.includes('past-paper')) return 'fas fa-history'; if (tags.includes('mcq')) return 'fas fa-list-check'; return 'fas fa-file-alt'; };
    const generatePremiumCode = (name) => { if (!name || name.length < 3) return null; const getPrecedingAndSuccessiveChars = (char) => { if (!char || typeof char !== 'string' || char.length !== 1) return { preceding: '', successive: '' }; const lowerChar = char.toLowerCase(); const code = lowerChar.charCodeAt(0); let preceding = '', successive = ''; if (code >= 97 && code <= 122) { preceding = String.fromCharCode(code === 97 ? 122 : code - 1); successive = String.fromCharCode(code === 122 ? 97 : code + 1); } return { preceding, successive }; }; const third = name.charAt(2).toLowerCase(); const { preceding, successive } = getPrecedingAndSuccessiveChars(third); return `${name}@1234${preceding}${successive}`; };
    const DarkModeToggle = () => { const [darkMode, setDarkMode] = useState(false); useEffect(() => { const isDark = localStorage.getItem('darkMode') === 'true'; setDarkMode(isDark); document.documentElement.classList.toggle('dark', isDark); }, []); const toggleDarkMode = () => { const newDarkMode = !darkMode; setDarkMode(newDarkMode); localStorage.setItem('darkMode', newDarkMode); document.documentElement.classList.toggle('dark', newDarkMode); }; return (<button onClick={toggleDarkMode} className="p-2 rounded-full bg-white/10 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" aria-label="Toggle dark mode">{darkMode ? <i className="fas fa-sun text-yellow-400"></i> : <i className="fas fa-moon"></i>}</button>); };
    const AchievementToast = ({ achievement, onDismiss }) => { useEffect(() => { const timer = setTimeout(onDismiss, 5000); return () => clearTimeout(timer); }, [onDismiss]); if (!achievement) return null; return ( <div className="fixed bottom-5 right-5 w-80 p-4 rounded-xl shadow-2xl animate-slideInUp z-[9999] glassmorphism"> <div className="flex items-center"> <div className="text-3xl text-yellow-400 mr-4"><i className={achievement.icon}></i></div> <div> <p className="font-bold text-lg text-white">Achievement Unlocked!</p> <p className="text-gray-200">{achievement.title}</p> </div> <button onClick={onDismiss} className="absolute top-2 right-2 text-white/50 hover:text-white">&times;</button> </div> </div> ); };
    const AppLoader = () => ( <div className="fixed inset-0 bg-slate-900 flex flex-col items-center justify-center z-[10000]"> <img src="https://raw.githubusercontent.com/ganeshdahal-HUE/practicece/6684a6cfa40eda8be7402689857a23575f0b723a/494645815_122099085086862980_1698079942897814974_n.jpg" alt="Logo" className="h-24 w-24 rounded-full shadow-lg mb-4 animate-pulse" /> <h1 className="text-3xl font-extrabold text-white tracking-tight">Balen Scholarship Prep</h1> <p className="text-white/70 mt-1">Preparing your dashboard...</p> </div> );
    const UserStats = ({ xp, streak, isPremium }) => { const level = Math.floor(xp / DATA.XP_PER_LEVEL) + 1; const xpInLevel = xp % DATA.XP_PER_LEVEL; const progress = (xpInLevel / DATA.XP_PER_LEVEL) * 100; const streakColor = streak > 30 ? "text-red-500" : streak > 10 ? "text-orange-400" : "text-amber-400"; return ( <div className="flex items-center gap-4 text-sm font-semibold"> {isPremium && <span className="flex items-center text-yellow-300 animate-pulse"><i className="fas fa-star mr-1"></i>PREMIUM</span>} {streak > 0 && <span className={`flex items-center ${streakColor}`}><i className={`fas fa-fire-alt mr-1`}></i>{streak} Day Streak</span>} <div className="flex items-center gap-2"> <span>Lvl {level}</span> <div className="w-20 h-2 bg-white/20 rounded-full"><div className="h-full bg-green-400 rounded-full" style={{width: `${progress}%`}}></div></div> </div> </div> ); };

    // =================================================================================
    // ===== NAME ENTRY SCREEN =====
    // =================================================================================
    const NameEntryScreen = ({ onNameSet }) => { const [name, setName] = useState(''); const handleSubmit = (e) => { e.preventDefault(); if (name.trim()) { onNameSet(name.trim()); } }; return ( <div className="min-h-screen w-full flex items-center justify-center p-4 bg-slate-900 bg-cover bg-center" style={{backgroundImage: "url('https://images.unsplash.com/photo-1557682250-33bd709cbe85?q=80&w=2070&auto=format&fit=crop&ixlib-rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D')"}}> <div className="w-full max-w-md glassmorphism rounded-2xl p-8 shadow-2xl animate-popIn"> <div className="text-center mb-8"> <img src="https://raw.githubusercontent.com/ganeshdahal-HUE/practicece/6684a6cfa40eda8be7402689857a23575f0b723a/494645815_122099085086862980_1698079942897814974_n.jpg" alt="Logo" className="h-20 w-20 rounded-full shadow-lg mx-auto mb-4 border-2 border-white/50" /> <h1 className="text-3xl font-bold text-white font-serif tracking-tight">Balen Scholarship Prep</h1> <p className="text-white/70 mt-2">Please enter your name to begin.</p> </div> <form onSubmit={handleSubmit} className="space-y-4"> <div className="relative"> <i className="fas fa-user absolute left-4 top-1/2 -translate-y-1/2 text-white/50"></i> <input type="text" value={name} onChange={(e) => setName(e.target.value)} placeholder="Enter Your Full Name" className="w-full pl-12 pr-4 py-3 rounded-lg border-0 bg-white/10 text-white placeholder-white/60 focus:ring-2 focus:ring-indigo-400 focus:outline-none transition" required /> </div> <button type="submit" className="w-full gradient-button text-white font-bold py-3 px-6 rounded-full shadow-lg text-lg uppercase tracking-wider mt-4">Continue</button> </form> </div> </div> ); };

    // =================================================================================
    // ===== HEADER & FOOTER =====
    // =================================================================================
    const Header = ({ setActiveSection, activeSection, isPremium, userStats, hasNewNotice }) => { const [isMenuOpen, setIsMenuOpen] = useState(false); const navItems = [ { key: 'home', label: 'Dashboard' }, { key: 'quizzes', label: 'Daily Quizzes' }, { key: 'competition', label: 'Competition' }, { key: 'resources', label: 'Resources' }, { key: 'entertainment', label: 'Brain Break' }, { key: 'videos', label: 'Videos' }, { key: 'notices', label: 'Notices' }, { key: 'faqs', label: 'FAQs' } ]; return ( <header className="sticky top-0 z-50 text-white glassmorphism"> <div className="container mx-auto flex justify-between items-center p-4"> <div className="flex items-center space-x-3"> <img src="https://raw.githubusercontent.com/ganeshdahal-HUE/practicece/6684a6cfa40eda8be7402689857a23575f0b723a/494645815_122099085086862980_1698079942897814974_n.jpg" alt="Site Logo" className="h-12 w-12 rounded-full shadow-md object-cover border-2 border-white/50" /> <div> <h1 className="text-xl sm:text-2xl font-extrabold tracking-tight">Balen Scholarship</h1> <div className="hidden md:block -mt-1"><UserStats {...userStats} isPremium={isPremium} /></div> </div> </div> <nav className="hidden lg:flex items-center gap-2"> {navItems.map(btn => (<button key={btn.key} onClick={() => setActiveSection(btn.key)} className={`relative nav-button bg-white/10 hover:bg-white/20 font-semibold py-2 px-3 rounded-lg shadow-sm transition-all duration-300 ${activeSection === btn.key ? 'active' : ''} ${btn.key === 'notices' && hasNewNotice ? 'nav-button-notify' : ''}`}>{btn.label}</button>))} <DarkModeToggle /> </nav> <div className="lg:hidden flex items-center gap-2"> <DarkModeToggle /> <button onClick={() => setIsMenuOpen(!isMenuOpen)} className="p-2 rounded-md text-white bg-white/10 hover:bg-white/20"><i className="fas fa-bars text-xl"></i></button> </div> </div> {isMenuOpen && (<nav className="lg:hidden mt-4 p-4 border-t border-white/20 animate-fadeIn">{navItems.map(btn => (<button key={btn.key} onClick={() => { setActiveSection(btn.key); setIsMenuOpen(false); }} className={`w-full text-center nav-button bg-white/10 hover:bg-white/20 font-semibold py-3 px-4 rounded-lg shadow-sm mb-2 ${activeSection === btn.key ? 'active' : ''}`}>{btn.label}</button>))}</nav>)} </header> ); };
    const Footer = () => (<footer className="bg-slate-900 text-white p-6 text-center shadow-inner mt-8"><div className="container mx-auto"><p className="font-semibold">&copy; 2024 Balen Scholarship Prep. Designed by Ganesh Dahal.</p><div className="flex justify-center space-x-5 mt-3"><a href="#" className="text-white/70 hover:text-blue-400"><i className="fab fa-facebook-f text-xl"></i></a><a href="#" className="text-white/70 hover:text-red-500"><i className="fab fa-youtube text-xl"></i></a><a href="#" className="text-white/70 hover:text-green-400"><i className="fab fa-whatsapp text-xl"></i></a></div></div></footer>);

    // =================================================================================
    // ===== MODAL COMPONENTS =====
    // =================================================================================
    const PaymentModal = ({ onPaymentSuccess, onClose, userName }) => { const [premiumCode, setPremiumCode] = useState(''); const [isLoading, setIsLoading] = useState(false); const [error, setError] = useState(''); const handleVerify = (e) => { e.preventDefault(); setError(''); const expectedCode = generatePremiumCode(userName); if (premiumCode === expectedCode) { setIsLoading(true); setTimeout(() => { setIsLoading(false); onPaymentSuccess(); }, 1500); } else { setError('Invalid Premium Code. Please check the code received from the admin.'); } }; return ( <div className="overlay"> <div className="modal-box glassmorphism text-white relative"> <button onClick={onClose} className="absolute top-4 right-4 text-white/50 hover:text-white text-2xl font-bold">&times;</button> <h2 className="text-3xl font-extrabold mb-2 font-serif">Unlock Premium Access</h2> <p className="text-white/80 mb-6">Gain instant access to all exclusive features.</p> <div className="text-center bg-green-900/50 border border-green-500/50 rounded-xl p-4 mb-6"> <p className="text-lg">One-Time Payment</p> <p className="text-5xl font-bold text-green-300">Rs. {DATA.premiumPrice}</p> </div> <div className="text-left space-y-4"> <div> <p className="font-bold text-lg mb-1">Step 1: Pay using eSewa</p> <p className="text-white/80">Open your eSewa app and send <span className="font-bold text-white">Rs. {DATA.premiumPrice}</span> to the following eSewa ID:</p> <div className="bg-black/30 p-3 rounded-lg mt-2 text-center text-xl font-mono tracking-widest">{DATA.esewaId}</div> </div> <div> <p className="font-bold text-lg mb-1">Step 2: Activate Your Account</p> <p className="text-white/80">After paying, contact the admin via WhatsApp to get your personal premium code, then enter it below to activate.</p> <a href={`https://wa.me/${DATA.whatsAppContactNumber}?text=${encodeURIComponent(`I have made the payment for the Balen Scholarship Prep Portal premium access. Please provide me with my premium code.`)}`} target="_blank" rel="noopener noreferrer" className="inline-block mt-2 mb-3 bg-green-500 text-white font-bold py-2 px-4 rounded-full text-sm"><i className="fab fa-whatsapp mr-2"></i>Contact Admin for Code</a> <form onSubmit={handleVerify} className="mt-2"> <input type="text" value={premiumCode} onChange={(e) => setPremiumCode(e.target.value)} placeholder="Enter Premium Code from Admin" className="w-full p-3 border-0 rounded-md bg-white/20 placeholder-white/60 text-white focus:ring-2 focus:ring-indigo-400 focus:outline-none" required /> {error && <p className="text-red-400 text-sm mt-2 text-center">{error}</p>} <button type="submit" className="w-full gradient-button text-white font-bold py-3 px-6 rounded-full shadow-lg text-lg mt-4" disabled={isLoading}> {isLoading ? ( <Fragment> <i className="fas fa-spinner fa-spin mr-2"></i>Activating... </Fragment> ) : ( <Fragment> <i className="fas fa-key mr-2"></i>Activate Premium </Fragment> )} </button> </form> </div> </div> </div> </div> ); };
 const PdfViewerModal = ({ pdfInfo, onClose }) => {
        if (!pdfInfo || !pdfInfo.url) return null;

        const [isLoading, setIsLoading] = useState(true);
        const viewerRef = useRef(null); // Ref for the fullscreen element

        // Generate a unique, stable key for the PDF to use in localStorage
        const pdfId = useMemo(() => pdfInfo.title.replace(/\s+/g, '_'), [pdfInfo]);

        // State for progress tracking and notes
        const [progressPage, setProgressPage] = useState('');
        const [savedPage, setSavedPage] = useState(null);
        const [showSavedConfirmation, setShowSavedConfirmation] = useState(false);
        const [notes, setNotes] = useState('');

        // Function to construct the high-quality embed URL
        const getEmbedUrl = useCallback((url, page) => {
            const fileIdMatch = url.match(/drive\.google\.com\/(?:file\/d\/|drive\/folders\/)([a-zA-Z0-9_-]+)/);
            if (!fileIdMatch) return null;
            // The /preview endpoint is reliable and provides a clean, embeddable view.
            let embedUrl = `https://drive.google.com/file/d/${fileIdMatch[1]}/preview`;
            if (page) {
                embedUrl += `#page=${page}`;
            }
            return embedUrl;
        }, []);
        
        // Load saved progress and notes when the modal opens
        useEffect(() => {
            const savedPageData = localStorage.getItem(`pdfProgress_${pdfId}`);
            if (savedPageData) {
                setSavedPage(savedPageData);
                setProgressPage(savedPageData);
            }
            const savedNotesData = localStorage.getItem(`pdfNotes_${pdfId}`);
            if (savedNotesData) {
                setNotes(savedNotesData);
            }
        }, [pdfId]);

        // Automatically save notes as the user types (debounced)
        useEffect(() => {
            const handler = setTimeout(() => {
                localStorage.setItem(`pdfNotes_${pdfId}`, notes);
            }, 1000); // Save 1 second after user stops typing
            return () => clearTimeout(handler);
        }, [notes, pdfId]);

        const handleSaveProgress = (e) => {
            e.preventDefault();
            localStorage.setItem(`pdfProgress_${pdfId}`, progressPage);
            setSavedPage(progressPage);
            setShowSavedConfirmation(true);
            setTimeout(() => setShowSavedConfirmation(false), 2500);
        };
        
        const handleFullscreen = () => {
            if (viewerRef.current) {
                viewerRef.current.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            }
        };

        const iframeUrl = useMemo(() => getEmbedUrl(pdfInfo.url, savedPage), [pdfInfo.url, savedPage, getEmbedUrl]);
        const preventContextMenu = (e) => e.preventDefault();

        return (
            <div className="overlay" onClick={onClose} onContextMenu={preventContextMenu}>
                <div 
                    className="bg-slate-900 border border-slate-700 p-0 rounded-xl overflow-hidden w-full h-full max-w-7xl max-h-[95vh] flex flex-col md:flex-row animate-popIn" 
                    onClick={e => e.stopPropagation()}
                >
                    {/* Main PDF Viewer Area */}
                    <div className="relative flex-grow bg-gray-800" ref={viewerRef}>
                        {isLoading && (
                            <div className="absolute inset-0 flex flex-col justify-center items-center text-white bg-gray-800 z-10">
                                <i className="fas fa-spinner fa-spin text-4xl mb-4"></i>
                                <p>Loading HD Document...</p>
                                {savedPage && <p className="text-sm text-gray-400 mt-2">Jumping to your bookmark on page {savedPage}...</p>}
                            </div>
                        )}
                        <iframe
                            src={iframeUrl}
                            onLoad={() => setIsLoading(false)}
                            className={`w-full h-full border-0 transition-opacity duration-500 ${isLoading ? 'opacity-0' : 'opacity-100'}`}
                            title="HD PDF Viewer"
                            // ** SECURITY ENHANCEMENT **
                            // This sandbox configuration allows the viewer to run scripts but blocks downloads, popups, and printing.
                            sandbox="allow-scripts allow-same-origin"
                        ></iframe>
                    </div>

                    {/* Tools & Notes Panel */}
                    <div className="w-full md:w-80 lg:w-96 flex-shrink-0 bg-slate-800/50 p-4 md:p-6 flex flex-col overflow-y-auto">
                        <div className="flex justify-between items-center mb-4">
                             <h3 className="text-xl font-bold text-white pr-4">{pdfInfo.title}</h3>
                             <div className="flex items-center gap-2 flex-shrink-0">
                                <button onClick={handleFullscreen} title="Fullscreen" className="bg-white/10 hover:bg-white/20 text-white rounded-full w-8 h-8 flex items-center justify-center">
                                    <i className="fas fa-expand"></i>
                                </button>
                                <button onClick={onClose} title="Close" className="bg-white/10 hover:bg-white/20 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl">&times;</button>
                             </div>
                        </div>
                        
                        {/* Progress Tracking Section */}
                        <div className="bg-slate-900/70 p-4 rounded-lg mb-6">
                             <h4 className="font-semibold text-white mb-2 flex items-center"><i className="fas fa-bookmark text-indigo-400 mr-2"></i> Bookmark Progress</h4>
                            <p className="text-sm text-slate-400 mb-3">
                                {savedPage ? `Last bookmark is on page ${savedPage}.` : "No bookmark set yet."}
                            </p>
                            <form onSubmit={handleSaveProgress} className="flex items-center gap-2">
                                <input 
                                    type="number" 
                                    value={progressPage} 
                                    onChange={(e) => setProgressPage(e.target.value)} 
                                    className="bg-slate-700 rounded-md px-3 py-2 w-full text-white placeholder-slate-400 focus:ring-2 focus:ring-indigo-500 focus:outline-none" 
                                    placeholder="Enter page #"
                                    required
                                />
                                <button type="submit" className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition-colors">Save</button>
                            </form>
                            {showSavedConfirmation && <p className="text-green-400 text-sm font-semibold mt-2 animate-fadeIn">Bookmark saved!</p>}
                        </div>

                        {/* Note Taking Section */}
                        <div className="flex-grow flex flex-col bg-slate-900/70 p-4 rounded-lg">
                            <h4 className="font-semibold text-white mb-2 flex items-center"><i className="fas fa-pencil-alt text-amber-400 mr-2"></i> My Notes</h4>
                            <p className="text-sm text-slate-400 mb-3">Your notes are saved automatically.</p>
                            <textarea
                                value={notes}
                                onChange={(e) => setNotes(e.target.value)}
                                placeholder="Write down your thoughts, summaries, or important points here..."
                                className="w-full h-full flex-grow bg-slate-700/80 text-white rounded-md p-3 text-sm placeholder-slate-400 focus:ring-2 focus:ring-amber-500 focus:outline-none min-h-[150px] resize-none"
                            ></textarea>
                        </div>
                    </div>
                </div>
            </div>
        );
    };
    const CompulsoryNoticeModal = ({ notice, onClose }) => { if (!notice) return null; return ( <div className="overlay"> <div className="modal-box glassmorphism text-white relative animate-popIn"> <h2 className="text-3xl font-bold mb-4 font-serif">{notice.title}</h2> <p className="text-sm text-white/70 mb-4">Posted on: {notice.date}</p> <div className="text-left text-white/90 leading-relaxed my-6 max-h-[40vh] overflow-y-auto" dangerouslySetInnerHTML={{ __html: notice.content }}></div> <button onClick={onClose} className="gradient-button text-white font-bold py-2 px-8 rounded-full shadow-md mt-4">I Understand</button> </div> </div> ); };
    const WinnerCertificateModal = ({ winnerInfo, onClose }) => {
        if (!winnerInfo) return null;
        const { name, rank, score, color, medal } = winnerInfo;
        const rankText = rank === 1 ? "1st Place" : rank === 2 ? "2nd Place" : "3rd Place";
        const rankColorClass = {amber: 'border-amber-400', slate: 'border-slate-400', orange: 'border-orange-500'}[color] || 'border-gray-400';
        const handleDownload = () => { const certElement = document.getElementById('winner-certificate'); if (certElement) { html2canvas(certElement, {backgroundColor: '#111827', useCORS: true}).then(canvas => { const link = document.createElement('a'); link.download = `Winner_Certificate_${name}.png`; link.href = canvas.toDataURL('image/png'); link.click(); }); } };
        return ( <div className="overlay"> <div className="modal-box bg-slate-900/80 backdrop-blur-lg border border-white/20 p-0 max-w-2xl w-full"> <div id="winner-certificate" className="relative p-8 text-white bg-slate-900"> <div className={`absolute inset-0 border-8 ${rankColorClass} rounded-lg`}></div> <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/az-subtle.png')] opacity-10"></div> <div className="relative text-center"> <h1 className="text-4xl font-serif text-amber-300">Certificate of Achievement</h1> <p className="mt-2 text-lg text-slate-300">Awarded for Outstanding Performance</p> <div className="my-8"> <p className="text-slate-400">This certificate is proudly presented to</p> <p className="text-5xl font-script my-3 text-white">{name}</p> <p className="text-slate-400">for securing the</p> <p className={`text-4xl font-bold my-2 text-${color}-400`}>{rankText} {medal}</p> <p className="text-slate-400">in the weekly quiz competition held on</p> <p className="font-semibold text-lg text-white">{DATA.competitionResults.date}</p> <p className="text-slate-400 mt-1">with a score of <span className="font-bold text-white">{score}</span>.</p> </div> <div className="flex justify-between items-center mt-10 border-t border-amber-400/30 pt-4"> <div><p className="font-script text-3xl">Ganesh Dahal</p><p className="text-xs text-slate-400 tracking-widest">PORTAL CREATOR</p></div> <img src="https://i.ibb.co/T0f0d3j/gold-seal-embossed.png" alt="Seal" className="w-24 h-24" /> </div> </div> </div> <div className="p-4 bg-black/20 flex flex-col sm:flex-row gap-4 justify-center"> <button onClick={handleDownload} className="gradient-button text-white font-bold py-2 px-6 rounded-full"><i className="fas fa-download mr-2"></i>Download Certificate</button> <button onClick={onClose} className="bg-white/20 text-white font-bold py-2 px-6 rounded-full">Close</button> </div> </div> </div> );
    };
    const CourseCompletionCelebration = ({ userName, onViewCertificate }) => {
        useEffect(() => { const container = document.getElementById('confetti-container'); if (!container) return; for (let i = 0; i < 50; i++) { const confetti = document.createElement('div'); confetti.className = 'confetti'; confetti.style.left = `${Math.random() * 100}vw`; confetti.style.animationDelay = `${Math.random() * 3}s`; confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`; container.appendChild(confetti); } }, []);
        return (<div className="overlay"><div id="confetti-container" className="absolute inset-0 overflow-hidden z-0"></div><div className="modal-box glassmorphism text-white relative animate-popIn border-2 border-amber-400/50 max-w-lg"><div className="text-7xl mb-4 animate-[tada_1.5s_ease-in-out]">🎉</div><h1 className="text-4xl font-extrabold font-serif text-amber-300">Congratulations, {userName}!</h1><p className="mt-4 text-lg text-white/90">You have successfully completed all the daily quizzes in the Balen Scholarship Preparatory Program!</p><p className="mt-2 text-white/80">Your dedication is inspiring. We wish you the best of luck in your exam!</p><button onClick={onViewCertificate} className="gradient-button text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg mt-8">View Your Certificate <i className="fas fa-arrow-right ml-2"></i></button></div></div>);
    };

    // =================================================================================
    // ===== PAGE SECTIONS =====
    // =================================================================================
    const HomeDashboard = ({ setActiveSection, userName, completedQuizzes, userStats, isPremium, activityLog }) => {
        const completedCount = Object.keys(completedQuizzes).length;
        const nextQuiz = DATA.dailyQuizzes.find(q => !completedQuizzes[q.day]);
        const xpInLevel = userStats.xp % DATA.XP_PER_LEVEL;
        const xpProgressPercentage = (xpInLevel / DATA.XP_PER_LEVEL) * 100;
        
        const getGreeting = () => { const hour = new Date().getHours(); if (hour < 12) return "Good morning"; if (hour < 18) return "Good afternoon"; return "Good evening"; };
        
        const CircularProgress = ({ percentage, size = 120 }) => {
            const strokeWidth = 10;
            const radius = (size - strokeWidth) / 2;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percentage / 100) * circumference;
            return (
                <div className="relative" style={{ width: size, height: size }}>
                    <svg width={size} height={size} className="transform -rotate-90"><circle cx={size / 2} cy={size / 2} r={radius} stroke="currentColor" strokeWidth={strokeWidth} fill="transparent" className="text-gray-200 dark:text-slate-700" /><circle cx={size / 2} cy={size / 2} r={radius} stroke="currentColor" strokeWidth={strokeWidth} fill="transparent" strokeDasharray={circumference} strokeDashoffset={offset} className="text-green-500 transition-all duration-700 ease-out" strokeLinecap="round" /></svg>
                    <div className="absolute inset-0 flex flex-col items-center justify-center"><span className="text-2xl font-bold">{Math.round(userStats.xp % DATA.XP_PER_LEVEL)}</span><span className="text-xs text-gray-500">XP</span></div>
                </div>
            );
        };

        let nextStepButton;
        if (nextQuiz) {
            if (!isPremium && nextQuiz.isPremium) {
                nextStepButton = <button onClick={() => setActiveSection('resources')} className="gradient-button text-white font-bold py-3 px-8 rounded-full shadow-xl text-lg"> Unlock Premium Quiz <i className="fas fa-star ml-2"></i> </button>;
            } else {
                nextStepButton = <button onClick={() => setActiveSection('quizzes')} className="gradient-button text-white font-bold py-3 px-8 rounded-full shadow-xl text-lg"> Go to Quizzes <i className="fas fa-arrow-right ml-2"></i> </button>;
            }
        }

        return (
            <section id="home">
                <div className="relative bg-gradient-to-br from-indigo-800 via-purple-800 to-blue-900 text-white overflow-hidden animate-gradient"><div className="container mx-auto px-4 py-16 md:py-24 relative z-10"><div className="text-center"><h1 className="text-4xl md:text-5xl font-black leading-tight tracking-tight animate-fadeIn">{getGreeting()}, <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-purple-300">{userName}!</span></h1><p className="mt-4 text-lg text-gray-200 max-w-xl mx-auto animate-fadeIn" style={{ animationDelay: '200ms' }}>Your journey to success continues here. Let's make today productive.</p></div></div></div>
                <div className="container mx-auto px-4 -mt-12 relative z-20">
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2 space-y-6">
                            <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-xl animate-slideInUp card-hover">
                                <h2 className="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Your Next Step</h2>
                                {nextQuiz ? (<div><p className="text-lg mb-2">Up next is the quiz for Day {nextQuiz.day}:</p><h3 className="text-3xl font-extrabold mb-4">{nextQuiz.title}</h3><p className="text-gray-500 dark:text-gray-400 mb-6">Subject: {nextQuiz.subject}</p>{nextStepButton}</div>) : (<div className="text-center py-8"><span className="text-7xl animate-tada inline-block">🎉</span><h3 className="text-3xl font-extrabold mt-4 text-green-500">All Quizzes Completed!</h3><p className="text-lg mt-2">Incredible work! Check your achievements or join a competition.</p></div>)}
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-xl animate-slideInUp card-hover" style={{animationDelay: '100ms'}}>
                                    <h2 className="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Quick Links</h2>
                                    <div className="grid grid-cols-2 gap-4"><button onClick={() => setActiveSection('competition')} className="flex flex-col items-center justify-center p-4 bg-gray-100 dark:bg-slate-800 rounded-lg hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition-colors"><i className="fas fa-trophy text-3xl text-indigo-500 mb-2"></i><span className="font-semibold text-sm text-center">Competition</span></button><button onClick={() => setActiveSection('resources')} className="flex flex-col items-center justify-center p-4 bg-gray-100 dark:bg-slate-800 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/50 transition-colors"><i className="fas fa-book-open text-3xl text-green-500 mb-2"></i><span className="font-semibold text-sm text-center">Resources</span></button></div>
                                </div>
                                <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-xl animate-slideInUp card-hover" style={{animationDelay: '200ms'}}>
                                    <h2 className="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Recent Activity</h2>
                                    {activityLog && activityLog.length > 0 ? (<ul className="space-y-3">{activityLog.slice(0, 3).map((activity, index) => (<li key={index} className="flex items-center text-sm animate-fadeIn" style={{animationDelay: `${index * 100}ms`}}><i className="fas fa-history text-gray-400 mr-3"></i><span className="text-gray-600 dark:text-gray-400">{activity}</span></li>))}</ul>) : <p className="text-gray-500 text-sm">No recent activity yet. Complete a quiz to get started!</p>}
                                </div>
                            </div>
                        </div>
                        <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-xl animate-slideInUp card-hover flex flex-col" style={{animationDelay: '300ms'}}>
                            <h2 className="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Your Progress</h2>
                            <div className="flex items-center justify-center my-4"><CircularProgress percentage={xpProgressPercentage} /></div>
                            <div className="space-y-4 mt-auto">
                                <div><p className="font-semibold">Level {Math.floor(userStats.xp / DATA.XP_PER_LEVEL) + 1}</p><p className="text-sm text-gray-500 dark:text-gray-400">{DATA.XP_PER_LEVEL - xpInLevel} XP to next level</p></div>
                                <div><p className="font-semibold">Current Streak</p><p className="text-3xl font-extrabold text-orange-500">{userStats.streak} <span className="text-lg font-bold">Days 🔥</span></p></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        );
    };
    const EntertainmentSection = ({ onBrainBreakComplete, checkAndUnlockAchievement }) => {
        const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
        const [dailyProgress, setDailyProgress] = useState(getJSONFromLocalStorage(`brainBreakProgress_${dayOfYear}`, { teasers: {}, riddle: false }));
        const [riddleGuess, setRiddleGuess] = useState('');
        const [riddleStatus, setRiddleStatus] = useState('unanswered');

        const teasers = DATA.entertainment.brainTeasers;
        const dailyTeasers = useMemo(() => [
            {...teasers[dayOfYear % teasers.length], id: `d${dayOfYear}t0`},
            {...teasers[(dayOfYear + 5) % teasers.length], id: `d${dayOfYear}t1`},
            {...teasers[(dayOfYear + 10) % teasers.length], id: `d${dayOfYear}t2`}
        ], [dayOfYear]);
        const riddle = useMemo(() => DATA.entertainment.riddles[dayOfYear % DATA.entertainment.riddles.length], [dayOfYear]);
        const quote = useMemo(() => DATA.entertainment.motivationalQuotes[dayOfYear % DATA.entertainment.motivationalQuotes.length], [dayOfYear]);
        
        const completedTeasersCount = Object.values(dailyProgress.teasers).filter(ans => ans.isCorrect).length;
        const progressCount = completedTeasersCount + (dailyProgress.riddle ? 1 : 0);
        
        const handleProgress = (activityType) => { onBrainBreakComplete(); if ((activityType === 'riddle' && completedTeasersCount > 0) || (activityType === 'teaser' && dailyProgress.riddle)) { checkAndUnlockAchievement('BRAIN_ACADEMY'); }};

        const handleTeaserSubmit = (teaserId, option, isCorrect) => {
            if(dailyProgress.teasers[teaserId]) return;
            const newProgress = { ...dailyProgress, teasers: { ...dailyProgress.teasers, [teaserId]: { answer: option, isCorrect } }};
            setDailyProgress(newProgress); localStorage.setItem(`brainBreakProgress_${dayOfYear}`, JSON.stringify(newProgress));
            if (isCorrect) handleProgress('teaser');
        };

        const handleRiddleSubmit = (e) => {
            e.preventDefault(); if(dailyProgress.riddle) return;
            if (riddle.answers.includes(riddleGuess.toLowerCase().trim())) {
                setRiddleStatus('correct');
                const newProgress = { ...dailyProgress, riddle: true };
                setDailyProgress(newProgress); localStorage.setItem(`brainBreakProgress_${dayOfYear}`, JSON.stringify(newProgress));
                handleProgress('riddle');
            } else { setRiddleStatus('incorrect'); setTimeout(() => setRiddleStatus('unanswered'), 2000); }
        };

        return ( <section id="entertainment" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800"> <div className="container mx-auto"> <h2 className="text-4xl font-extrabold text-center text-red-500 dark:text-red-400 mb-4 animate-fadeIn">Brain Break Zone</h2> <p className="text-center text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto mb-8">Take a fun break, challenge your mind, and earn extra XP!</p> <div className="lg:col-span-2 bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg card-hover animate-slideInUp mb-8"> <h3 className="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4 flex items-center"><i className="fas fa-quote-left mr-3"></i>Quote of the Day</h3> <p className="text-xl italic text-gray-700 dark:text-gray-300">"{quote.quote}"</p> <p className="text-right mt-4 font-semibold text-gray-500 dark:text-gray-400">- {quote.author}</p> </div> <div className="grid grid-cols-1 lg:grid-cols-2 gap-8"> <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg card-hover animate-slideInUp"> <h3 className="text-2xl font-bold text-green-600 dark:text-green-400 mb-4 flex items-center"><i className="fas fa-bolt mr-3"></i>Daily Brain Teasers</h3> <div className="space-y-6"> {dailyTeasers.map((teaser) => { const userAnswer = dailyProgress.teasers[teaser.id]; return (<div key={teaser.id}> <p className="text-lg text-gray-700 dark:text-gray-300 mb-4 font-semibold">{teaser.question}</p> <div className="space-y-3">{teaser.options.map(option => { const isCorrect = option === teaser.correctAnswer; const isSelected = userAnswer?.answer === option; let buttonClass = "w-full text-left p-3 rounded-lg border-2 transition-all font-semibold "; if (userAnswer) { if (isCorrect) buttonClass += "bg-green-200 border-green-400 text-green-800"; else if (isSelected) buttonClass += "bg-red-200 border-red-400 text-red-800"; else buttonClass += "bg-gray-100 dark:bg-slate-800 border-gray-200 dark:border-slate-700 opacity-60"; } else { buttonClass += "bg-gray-100 dark:bg-slate-800 border-gray-200 dark:border-slate-700 hover:bg-indigo-100 hover:border-indigo-400"; } return <button key={option} disabled={!!userAnswer} onClick={() => handleTeaserSubmit(teaser.id, option, isCorrect)} className={buttonClass}>{option}</button>; })}</div> {userAnswer?.isCorrect && <p className="mt-4 text-sm font-semibold text-green-500 animate-tada">Completed! +{DATA.XP_PER_BRAIN_BREAK} XP</p>} </div>)})} </div></div> <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg card-hover animate-slideInUp" style={{animationDelay: '100ms'}}> <h3 className="text-2xl font-bold text-amber-600 dark:text-amber-400 mb-4 flex items-center"><i className="fas fa-puzzle-piece mr-3"></i>Riddle Challenge</h3> <p className="text-lg text-gray-700 dark:text-gray-300 mb-4">{riddle.riddle}</p> {riddleStatus !== 'correct' && !dailyProgress.riddle ? ( <form onSubmit={handleRiddleSubmit} className="flex gap-2"> <input type="text" value={riddleGuess} onChange={e => setRiddleGuess(e.target.value)} placeholder="Your answer..." className="flex-grow p-2 rounded-lg border-2 bg-gray-100 dark:bg-slate-800 focus:ring-2 focus:ring-amber-500" /> <button type="submit" className="bg-amber-500 text-white font-bold px-4 rounded-lg">Submit</button> </form> ) : null} {(riddleStatus === 'correct' || dailyProgress.riddle) && <p className="text-green-500 font-bold animate-tada">Correct! +{DATA.XP_PER_BRAIN_BREAK} XP</p>} {riddleStatus === 'incorrect' && <p className="text-red-500 font-bold">Not quite, try again!</p>} </div> </div> </div> </section> ); };
    const QuizzesSection = ({ isPremium, completedQuizzes, userStats, onQuizComplete, onPremiumUnlock, onStateRefresh }) => { const [showPaymentModal, setShowPaymentModal] = useState(false); const [showShareModal, setShowShareModal] = useState(false); const {unlockedByStreak, unlockedByShare, hasShared, dailyUnlocks} = getJSONFromLocalStorage('balenQuizUnlocks', {unlockedByStreak: 0, unlockedByShare: 0, hasShared: false, dailyUnlocks: 0}); const preparedQuizzes = useMemo(() => { const quizzesCompletedPremium = DATA.dailyQuizzes.filter(q => q.isPremium && completedQuizzes[q.day]).length; const canUnlockReward = !isPremium && (unlockedByShare + unlockedByStreak > quizzesCompletedPremium); return DATA.dailyQuizzes.map((quiz, index) => { let status = 'Locked', statusText = 'Complete prior quizzes to unlock.', buttonText = 'Locked'; if (completedQuizzes[quiz.day]) { status = 'Completed'; statusText = 'You have completed this quiz.'; buttonText = 'Play Again'; } else { const quizzesBefore = DATA.dailyQuizzes.slice(0, index); if (quizzesBefore.every(q => completedQuizzes[q.day])) { if (dailyUnlocks >= 2 && !isPremium) { statusText = "You've unlocked your 2 free quizzes for today. Come back tomorrow or get Premium."; } else { if (!quiz.isPremium) { status = 'Unlocked'; statusText = 'This quiz is available for you.'; buttonText = 'Start Quiz'; } else { if (isPremium) { status = 'Unlocked'; statusText = 'Unlocked with Premium Access.'; buttonText = 'Start Quiz'; } else if (canUnlockReward) { status = 'Unlocked'; statusText = 'Unlock a premium quiz with a reward! (Max 2 per day)'; buttonText = 'Unlock with Reward'; } else { status = 'Requires Premium'; statusText = 'Unlock via Premium Access or by earning rewards.'; buttonText = 'Unlock'; } } } } } return { ...quiz, status, statusText, buttonText }; }); }, [completedQuizzes, isPremium, unlockedByStreak, unlockedByShare, dailyUnlocks]); const handleQuizClick = (e, day, link, status) => { if (status !== 'Unlocked' && status !== 'Completed') { e.preventDefault(); return; } if (status === 'Unlocked') { if (!completedQuizzes[day] && !DATA.dailyQuizzes.find(q=>q.day === day).isPremium) { const currentUnlocks = getJSONFromLocalStorage('balenQuizUnlocks', {}); localStorage.setItem('balenQuizUnlocks', JSON.stringify({...currentUnlocks, dailyUnlocks: (currentUnlocks.dailyUnlocks || 0) + 1})); } onQuizComplete(day); } window.open(link, '_blank'); }; const handleShare = () => { localStorage.setItem('balenQuizUnlocks', JSON.stringify({unlockedByStreak, unlockedByShare: 5, hasShared: true, dailyUnlocks})); setShowShareModal(false); onStateRefresh(); }; return ( <section id="quizzes" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800"> <div className="container mx-auto"> <h2 className="text-4xl font-extrabold text-center text-red-500 dark:text-red-400 mb-10 animate-fadeIn">Daily Quizzes</h2> <div className="mb-10 p-6 bg-white dark:bg-slate-900 rounded-2xl shadow-md animate-popIn"> <h3 className="text-2xl font-bold text-gray-900 dark:text-white mb-4">Your Quiz Progress</h3> <p className="text-lg text-gray-600 dark:text-gray-400 mt-2">{Object.keys(completedQuizzes).length} out of {DATA.dailyQuizzes.length} quizzes completed</p> </div> {!isPremium && (<div className="flex flex-col md:flex-row gap-4 mb-8"> {hasShared ? (<div className="flex-1 text-center bg-green-100 dark:bg-green-900/50 p-6 rounded-2xl shadow"> <h3 className="text-2xl font-bold text-green-700 dark:text-green-300">Thank You For Sharing!</h3> <p className="text-green-600 dark:text-green-400 my-2">You've unlocked {unlockedByShare} premium quizzes. Keep up your daily streak to unlock more!</p></div>) : (<div className="flex-1 text-center bg-green-100 dark:bg-green-900/50 p-6 rounded-2xl shadow"> <h3 className="text-2xl font-bold text-green-700 dark:text-green-300">Share & Unlock!</h3> <p className="text-green-600 dark:text-green-400 my-2">Share our portal to unlock 5 premium quizzes for free!</p> <button onClick={() => setShowShareModal(true)} className="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg">Share Now</button> </div>)} <div className="flex-1 text-center bg-amber-100 dark:bg-amber-900/50 p-6 rounded-2xl shadow"> <h3 className="text-2xl font-bold text-amber-700 dark:text-amber-300">Unlock All Quizzes</h3> <p className="text-amber-600 dark:text-amber-400 my-2">Get premium access to unlock all quizzes and materials permanently.</p> <button onClick={() => setShowPaymentModal(true)} className="gradient-button text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg">Get Premium</button> </div> </div>)} {showPaymentModal && <PaymentModal onPaymentSuccess={onPremiumUnlock} onClose={() => setShowPaymentModal(false)} userName={userStats.name} />} {showShareModal && (<div className="overlay"><div className="modal-box glassmorphism text-white"><h3>Share to Unlock Quizzes!</h3><p className="mt-2 mb-4">Share this link on any social media platform. After sharing, click the button below to claim your reward.</p><div className="flex justify-center gap-4 text-4xl mb-6"><a href={'https://www.facebook.com/sharer/sharer.php?u='+window.location.href} target="_blank" className="text-blue-400 hover:scale-110 transition-transform"><i className="fab fa-facebook"></i></a><a href={'https://wa.me/?text=Check out this amazing Balen Scholarship Prep Portal: '+window.location.href} target="_blank" className="text-green-400 hover:scale-110 transition-transform"><i className="fab fa-whatsapp"></i></a></div><button onClick={handleShare} className="gradient-button text-white font-bold py-3 px-8 rounded-full">I've Shared It!</button></div></div>)} <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"> {preparedQuizzes.map((quiz, i) => { const statusColors = { 'Completed': 'border-green-500', 'Unlocked': 'border-blue-500', 'Locked': 'border-gray-400', 'Requires Premium': 'border-amber-500' }; const buttonIcons = { 'Start Quiz': 'fa-arrow-right', 'Play Again': 'fa-redo', 'Unlock': 'fa-star', 'Unlock with Reward': 'fa-gift', 'Locked': 'fa-lock' }; const isDisabled = quiz.status === 'Locked' || (quiz.statusText.includes("your 2 free quizzes for today") && !quiz.isPremium && !isPremium); return ( <div key={quiz.day} className={`bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg card-hover flex flex-col border-t-4 ${statusColors[quiz.status]} animate-slideInUp`} style={{animationDelay: `${i*50}ms`}}> <div className="flex-grow"> <h3 className="text-xl font-bold text-gray-900 dark:text-white mb-2">Day {quiz.day}: {quiz.title}</h3> <p className="text-gray-600 dark:text-gray-400 mb-3">Subject: {quiz.subject}</p> <p className={`font-semibold mb-1 text-sm ${{ 'Completed': 'text-green-600 dark:text-green-400', 'Unlocked': 'text-blue-600 dark:text-blue-400', 'Locked': 'text-gray-500 dark:text-gray-400', 'Requires Premium': 'text-amber-600 dark:text-amber-400' }[quiz.status]}`}>Status: {quiz.status}</p> <p className="text-xs text-gray-500 dark:text-gray-400 mb-4">{quiz.statusText}</p> </div> <button onClick={quiz.status === 'Requires Premium' ? () => setShowPaymentModal(true) : (e) => handleQuizClick(e, quiz.day, quiz.link, quiz.status)} disabled={isDisabled} className={`w-full mt-auto font-bold py-2 px-4 rounded-full shadow-md text-sm transition-transform duration-200 ${!isDisabled ? 'gradient-button text-white' : 'bg-gray-300 dark:bg-slate-700 text-gray-500 dark:text-gray-400 cursor-not-allowed'}`}> <span>{quiz.buttonText} <i className={`fas ${buttonIcons[quiz.buttonText] || 'fa-question-circle'} ml-2`}></i></span> </button> </div> ); })} </div> </div> </section> ); };
    const QuizCompetitionSection = ({ isPremium, onSetUserName, unlockedAchievements, checkAndUnlockAchievement, onShowPremiumCert, onShowCompletionCert }) => {
        const [activeTab, setActiveTab] = useState('quiz');
        const [user, setUser] = useState(null);
        const [showModal, setShowModal] = useState(false);
        const [error, setError] = useState(null);
        const [quizStatus, setQuizStatus] = useState({ isActive: false, countdown: 'Loading...', nextQuizDay: '' });
        const [showWinnerCertificate, setShowWinnerCertificate] = useState(null);
        const [podiumStats, setPodiumStats] = useState({ first: 0, second: 0, third: 0 });

        useEffect(() => {
            const storedUser = getJSONFromLocalStorage('quizHubUser', null);
            if (storedUser) {
                setUser(storedUser);
                const history = getJSONFromLocalStorage('userPodiumHistory', []);
                const fourMonthsAgo = new Date(); fourMonthsAgo.setMonth(fourMonthsAgo.getMonth() - 4);
                
                const recentHistory = history.filter(h => new Date(h.date) >= fourMonthsAgo);
                const stats = recentHistory.reduce((acc, h) => { if (h.rank === 1) acc.first++; else if (h.rank === 2) acc.second++; else if (h.rank === 3) acc.third++; return acc; }, { first: 0, second: 0, third: 0 });
                setPodiumStats(stats);
                
                if (stats.first + stats.second + stats.third >= 3) { checkAndUnlockAchievement('THREE_WINS'); }
                
                const seenResultKey = `seenCompResult_${DATA.competitionResults.date}`;
                if (!localStorage.getItem(seenResultKey)) {
                    const winnerInfo = DATA.competitionResults.podium.find(p => p.symbol === storedUser.symbol);
                    if (winnerInfo) {
                        setShowWinnerCertificate(winnerInfo);
                        localStorage.setItem(seenResultKey, 'true');
                        const isAlreadyRecorded = history.some(h => h.date === DATA.competitionResults.date);
                        if (!isAlreadyRecorded) {
                            history.push({ date: DATA.competitionResults.date, rank: winnerInfo.rank, score: winnerInfo.score });
                            localStorage.setItem('userPodiumHistory', JSON.stringify(history));
                        }
                    }
                }
            } else { setShowModal(true); }
        }, []);

        const handleJoin = (e) => { e.preventDefault(); setError(null); const name = e.target.elements.userName.value; const symbol = e.target.elements.symbolNumber.value; if (DATA.validSymbolNumbers.includes(symbol)) { const newUser = { name, symbol }; localStorage.setItem('quizHubUser', JSON.stringify(newUser)); onSetUserName(name); setUser(newUser); setShowModal(false); } else { setError({ message: `Invalid Symbol Number.` }); } };
        useEffect(() => { const quizDays = [1, 3, 6]; const quizStartHour = 20; const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]; const calculateQuizState = () => { const now = new Date(); const currentDay = now.getDay(); const currentHour = now.getHours(); for (const quizDay of quizDays) { if (currentDay === quizDay && currentHour >= quizStartHour) { setQuizStatus({ isActive: true, countdown: 'Live Now!', nextQuizDay: '' }); return; } } let nextQuizDate = new Date(now); nextQuizDate.setHours(quizStartHour, 0, 0, 0); let nextDay = -1; for (const quizDay of quizDays) { if (quizDay > currentDay || (quizDay === currentDay && currentHour < quizStartHour)) { nextDay = quizDay; break; } } if (nextDay !== -1) { nextQuizDate.setDate(now.getDate() + (nextDay - currentDay)); } else { nextDay = quizDays[0]; nextQuizDate.setDate(now.getDate() + (7 - currentDay + nextDay)); } const diff = nextQuizDate.getTime() - now.getTime(); const d = Math.floor(diff / (1000 * 60 * 60 * 24)); const h = Math.floor((diff / (1000 * 60 * 60)) % 24); const m = Math.floor((diff / 1000 / 60) % 60); const s = Math.floor((diff / 1000) % 60); setQuizStatus({ isActive: false, countdown: `${d}d:${h.toString().padStart(2,'0')}h:${m.toString().padStart(2,'0')}m:${s.toString().padStart(2,'0')}s`, nextQuizDay: dayNames[nextDay] }); }; calculateQuizState(); const timer = setInterval(calculateQuizState, 1000); return () => clearInterval(timer); }, []);
        const handleDownload = () => { if (!isPremium) { alert("This is a premium feature."); return; } const element = document.getElementById('results-to-download'); if (element) { html2canvas(element, { backgroundColor: '#111827', useCORS: true }).then(canvas => { const link = document.createElement('a'); link.download = `results-${DATA.competitionResults.date}.png`; link.href = canvas.toDataURL('image/png'); link.click(); }); } };
        const renderUserHighlight = (text) => `${text} <span class="text-yellow-400 font-bold">(You)</span>`;
        
        return (
            <section id="competition" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800">
                {showWinnerCertificate && <WinnerCertificateModal winnerInfo={showWinnerCertificate} onClose={() => setShowWinnerCertificate(null)} />}
                <div className="container mx-auto">
                    <header className="text-center p-8 md:p-12 text-white rounded-2xl shadow-xl relative overflow-hidden bg-gradient-to-br from-indigo-700 via-purple-700 to-blue-800 animate-gradient"> <div className="relative z-10">{user && <p className="absolute top-4 left-4 text-sm bg-black/30 px-3 py-1 rounded-full">Welcome, <span className="font-bold text-yellow-300">{user.name}</span> ({user.symbol})</p>}<h1 className="text-3xl md:text-5xl font-extrabold mb-2 animate-popIn">Quiz Competition Hub</h1><p className="text-lg md:text-xl opacity-90">Test your skills, climb the leaderboard, and earn achievements.</p></div></header>
                    {user ? ( <div>
                        <div className="flex flex-wrap justify-center my-6 bg-white dark:bg-slate-900 rounded-xl shadow-md p-2">{['quiz', 'results', 'leaderboard', 'achievements'].map(tab => (<button key={tab} onClick={() => setActiveTab(tab)} className={`capitalize px-4 py-2 md:px-8 md:py-3 font-semibold rounded-lg transition-all duration-300 ${activeTab === tab ? 'bg-indigo-600 text-white shadow' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-slate-700'}`}>{tab}</button>))}</div>
                        <div className="bg-white dark:bg-slate-900 rounded-2xl shadow-lg p-4 md:p-8 animate-fadeIn">
                            {activeTab === 'quiz' && ( <div className="text-center bg-gray-100 dark:bg-slate-800 p-8 rounded-xl"> <h2 className="text-2xl md:text-3xl font-bold mb-4 text-indigo-600 dark:text-indigo-400">Weekly Quiz Challenge</h2> {quizStatus.isActive ? ( <div> <p className="text-lg mb-6 text-green-600 dark:text-green-400 font-semibold animate-pulse">The quiz is LIVE now!</p> <a href="#" target="_blank" rel="noopener noreferrer" className="gradient-button inline-block text-white font-bold py-3 px-10 rounded-full shadow-lg text-lg uppercase tracking-wide"> Join Live Quiz </a> </div> ) : ( <div> <p className="text-lg mb-2">Next quiz on <span className="font-bold text-indigo-500 dark:text-indigo-400">{quizStatus.nextQuizDay} at 8 PM</span>.</p> <div className="font-mono text-4xl md:text-5xl font-bold tracking-tight text-gray-800 dark:text-gray-200 my-4"> {quizStatus.countdown} </div> <button disabled className="gradient-button inline-block text-white font-bold py-3 px-10 rounded-full shadow-lg text-lg uppercase tracking-wide opacity-50 cursor-not-allowed"> Quiz Locked </button> </div> )} </div> )}
                            {activeTab === 'results' && (<div><div className="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4"><div><h2 className="text-2xl md:text-3xl font-bold text-indigo-600 dark:text-indigo-400">Latest Quiz Results</h2><p className="text-gray-500 dark:text-gray-400">Results for: {DATA.competitionResults.date}</p></div><button onClick={handleDownload} disabled={!isPremium} className="gradient-button text-white font-bold py-2 px-4 rounded-full shadow-md text-sm disabled:opacity-50 flex-shrink-0"><i className={`fas ${isPremium ? 'fa-download' : 'fa-lock'} mr-2`}></i> Download</button></div><div className="my-8 bg-gray-100 dark:bg-slate-800 rounded-2xl p-6"> <h3 className="text-2xl font-bold text-center text-indigo-600 dark:text-indigo-400 mb-4">Your Podium Stats (Last 4 Months)</h3> <div className="flex justify-around text-center"> <div className="px-2"><p className="text-4xl font-bold text-amber-500">{podiumStats.first}</p><p className="font-semibold text-gray-600 dark:text-gray-400">🏆 1st</p></div> <div className="px-2"><p className="text-4xl font-bold text-slate-500">{podiumStats.second}</p><p className="font-semibold text-gray-600 dark:text-gray-400">🥈 2nd</p></div> <div className="px-2"><p className="text-4xl font-bold text-orange-600">{podiumStats.third}</p><p className="font-semibold text-gray-600 dark:text-gray-400">🥉 3rd</p></div> </div> </div><div className="flex flex-col md:flex-row justify-center items-end gap-4 md:gap-8 mb-8 text-center">{DATA.competitionResults.podium.map(p => (<div key={p.rank} className={`p-4 rounded-xl card-hover ${p.rank === 1 ? 'order-first md:order-2' : p.rank === 2 ? 'order-2 md:order-1' : 'order-last md:order-3'}`}><span className="text-4xl">{p.medal}</span><img src={p.img} alt={p.name} className={`w-24 h-24 md:w-32 md:h-32 rounded-full mx-auto my-2 object-cover border-4 border-${p.color}-400 shadow-lg`}/><p className="font-bold text-lg" dangerouslySetInnerHTML={{__html: user?.symbol === p.symbol ? renderUserHighlight(p.name) : p.name}}></p><p className="text-gray-500 dark:text-gray-400">{p.symbol}</p><p className="text-gray-600 dark:text-gray-400">{p.score}</p></div>))}</div><div className="overflow-x-auto"><table className="w-full text-left"><thead className="bg-gray-100 dark:bg-slate-800"><tr><th className="p-3">Rank</th><th className="p-3">Name</th><th className="p-3">Symbol</th><th className="p-3">Score</th></tr></thead><tbody>{DATA.competitionResults.table.map(r => (<tr key={r.rank}><td className="p-3">{r.rank}</td><td className="p-3" dangerouslySetInnerHTML={{__html: user?.symbol === r.symbol ? renderUserHighlight(r.name) : r.name}}></td><td className="p-3">{r.symbol}</td><td className="p-3">{r.score}</td></tr>))}</tbody></table></div></div>)}
                            {activeTab === 'leaderboard' && (<div><h2 className="text-2xl md:text-3xl font-bold text-center mb-6 text-indigo-600 dark:text-indigo-400">All-Time Leaderboard</h2><div className="overflow-x-auto bg-gray-100 dark:bg-slate-800 rounded-xl p-4"><table className="w-full text-left table-auto"><thead className="border-b-2 border-gray-300 dark:border-slate-600"><tr><th className="p-3 font-bold uppercase text-sm">Rank</th><th className="p-3 font-bold uppercase text-sm">Name</th><th className="p-3 font-bold uppercase text-sm">Symbol</th><th className="p-3 font-bold uppercase text-sm text-right">Total XP</th></tr></thead><tbody>{DATA.leaderboardData.map((player) => (<tr key={player.rank} className={`border-b border-gray-200 dark:border-slate-700 transition-colors ${user?.symbol === player.symbol ? 'bg-yellow-100 dark:bg-yellow-900/40' : 'hover:bg-gray-200/50 dark:hover:bg-slate-700/50'}`}><td className="p-3 font-bold text-lg">{player.medal || player.rank}</td><td className="p-3 font-semibold">{player.name} {user?.symbol === player.symbol && <span className="text-yellow-500 font-bold text-xs ml-1">(You)</span>}</td><td className="p-3 font-mono text-sm text-gray-500 dark:text-gray-400">{player.symbol}</td><td className="p-3 font-bold text-right text-indigo-500 dark:text-indigo-400">{player.score.toLocaleString()}</td></tr>))}</tbody></table></div></div>)}
                            {activeTab === 'achievements' && (<div><h2 className="text-2xl md:text-3xl font-bold text-center mb-6 text-indigo-600 dark:text-indigo-400">Your Achievements</h2><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{Object.values(DATA.achievementsList).map(ach => { const isUnlocked = unlockedAchievements[ach.id]; return (<div key={ach.id} className={`p-6 rounded-2xl shadow-lg transition-all duration-300 ${isUnlocked ? 'bg-amber-100 dark:bg-amber-900/40 border-t-4 border-amber-400' : 'bg-gray-100 dark:bg-slate-800'}`}> <div className="flex items-center gap-4 mb-3"> <i className={`${ach.icon} text-3xl ${isUnlocked ? 'text-amber-500' : 'text-gray-400 dark:text-gray-500'}`}></i> <div> <h4 className={`text-xl font-bold ${isUnlocked ? 'text-amber-800 dark:text-amber-300' : 'text-gray-600 dark:text-gray-400'}`}>{ach.title}</h4> <p className="text-sm text-gray-500 dark:text-gray-500">{isUnlocked ? "Unlocked!" : "Locked"}</p> </div> </div> <p className="text-gray-600 dark:text-gray-400 mb-4">{ach.description}</p> {ach.hasCertificate && isUnlocked && ( <button onClick={ach.id === 'PREMIUM_USER' ? onShowPremiumCert : onShowCompletionCert} className="bg-amber-500 text-white font-bold py-1 px-3 rounded-full text-sm"> <i className="fas fa-download mr-1"></i> Certificate </button> )} </div>)})}</div></div>)}
                        </div>
                    </div> ) : ( <div className="text-center p-8 mt-6 bg-white dark:bg-slate-900 rounded-2xl shadow-lg"> <h2 className="text-3xl font-bold">Join the Competition!</h2> {error ? <p className="mt-2 text-red-500">{error.message}</p> : <p className="mt-2 text-gray-600 dark:text-gray-400">Log in with your details to participate in live quizzes and see your rank.</p>} <button onClick={() => setShowModal(true)} className="gradient-button text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg mt-6">Log In Now</button> </div> )}
                    {showModal && !user && (<div className="overlay"><div className="modal-box glassmorphism text-white relative"><button onClick={() => setShowModal(false)} className="absolute top-2 right-3 text-white/50 hover:text-white text-2xl font-bold">&times;</button><div><h3 className="text-2xl font-bold mb-2">Join the Competition!</h3><p className="mb-4 text-white/80">Enter your details to participate and appear on the leaderboard.</p><form onSubmit={handleJoin} className="flex flex-col gap-3"><input type="text" name="userName" placeholder="Your Name" required className="p-3 border-0 rounded-md bg-white/20 placeholder-white/60 text-white focus:ring-2 focus:ring-indigo-400 focus:outline-none" /><input type="text" name="symbolNumber" placeholder="Symbol Number" required className="p-3 border-0 rounded-md bg-white/20 placeholder-white/60 text-white focus:ring-2 focus:ring-indigo-400 focus:outline-none" />{error && <p className="text-red-400 text-sm -mb-1">{error.message}</p>}<button type="submit" className="gradient-button text-white font-bold py-2 px-6 rounded-full shadow-md mt-2">Join Now</button></form></div></div></div>)}
                </div>
            </section>
        );
    };
    const PremiumLockOverlay = ({ onStartTrial, onUnlock, hasUsedTrial, isTrialActive, timeLeft }) => { const formatTime = (ms) => { if (ms <= 0) return "00:00"; const totalSeconds = Math.floor(ms / 1000); const minutes = Math.floor(totalSeconds / 60).toString().padStart(2, '0'); const seconds = (totalSeconds % 60).toString().padStart(2, '0'); return `${minutes}:${seconds}`; }; return ( <div className="absolute inset-0 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md z-20 flex flex-col justify-center items-center rounded-2xl p-4 text-center"> {isTrialActive ? ( <Fragment> <div className="animate-pulse flex items-center gap-3 text-2xl font-bold text-slate-800 dark:text-white mb-2"> <i className="fas fa-eye text-green-500"></i> Free Preview Active </div> <p className="text-slate-600 dark:text-slate-300 mb-4">Time Remaining:</p> <div className="font-mono text-4xl font-extrabold text-slate-900 dark:text-white tracking-wider">{formatTime(timeLeft)}</div> </Fragment> ) : ( <Fragment> <i className="fas fa-lock text-5xl text-amber-500 mb-4"></i> <h4 className="text-2xl font-bold text-slate-800 dark:text-white">Premium Content Locked</h4> <p className="text-slate-600 dark:text-slate-300 my-2 max-w-sm"> {hasUsedTrial ? "Your free preview has ended. Unlock permanently to get full access." : "Get a 15-minute free preview to explore all premium materials, or unlock them permanently." } </p> <div className="flex flex-col sm:flex-row gap-4 mt-4"> {!hasUsedTrial && ( <button onClick={onStartTrial} className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full shadow-md transition-transform hover:scale-105"> Start 15-Min Preview </button> )} <button onClick={onUnlock} className="gradient-button text-white font-bold py-2 px-6 rounded-full shadow-md"> Get Premium Access </button> </div> </Fragment> )} </div> ); };
const ResourcesSection = ({ isPremium, onPremiumUnlock, userName }) => {
        const [searchTerm, setSearchTerm] = useState('');
        const [activeTag, setActiveTag] = useState('all');
        const [showPaymentModal, setShowPaymentModal] = useState(false);
        const [pdfToView, setPdfToView] = useState(null);
        const [trialState, setTrialState] = useState({ hasUsedTrial: false, isTrialActive: false, timeLeft: 0 });
        const questionWhatsAppLink = `https://wa.me/${DATA.whatsAppContactNumber}?text=${encodeURIComponent(`Hello! I'm a premium member of the Balen Prep Portal and I have a question. My name is ${userName}.`)}`;
        
        useEffect(() => {
            const hasUsed = getJSONFromLocalStorage('balenHasUsedTrial', false);
            const endTime = getJSONFromLocalStorage('balenTrialEndTime', null);
            let intervalId;
            if (endTime && Date.now() < endTime) {
                const updateTimer = () => {
                    const remaining = endTime - Date.now();
                    if (remaining > 0) {
                        setTrialState({ hasUsedTrial: true, isTrialActive: true, timeLeft: remaining });
                    } else {
                        setTrialState({ hasUsedTrial: true, isTrialActive: false, timeLeft: 0 });
                        localStorage.removeItem('balenTrialEndTime');
                        clearInterval(intervalId);
                    }
                };
                updateTimer();
                intervalId = setInterval(updateTimer, 1000);
            } else {
                setTrialState({ hasUsedTrial: hasUsed, isTrialActive: false, timeLeft: 0 });
            }
            return () => clearInterval(intervalId);
        }, []);

        const handleStartTrial = () => {
            const FIFTEEN_MINUTES_MS = 15 * 60 * 1000;
            const endTime = Date.now() + FIFTEEN_MINUTES_MS;
            localStorage.setItem('balenHasUsedTrial', JSON.stringify(true));
            localStorage.setItem('balenTrialEndTime', JSON.stringify(endTime));
            window.location.reload();
        };

        const allTags = useMemo(() => {
            const tags = new Set();
            DATA.resources.forEach(cat => cat.items.forEach(item => item.tags.forEach(tag => tags.add(tag))));
            return ['all', ...Array.from(tags).sort()];
        }, []);

        const filteredResources = useMemo(() => {
            return DATA.resources.map(category => ({
                ...category,
                items: category.items.filter(item => {
                    const matchesTag = activeTag === 'all' || item.tags.includes(activeTag);
                    const matchesSearch = item.title.toLowerCase().includes(searchTerm.toLowerCase());
                    return matchesTag && matchesSearch;
                })
            })).filter(category => category.items.length > 0);
        }, [searchTerm, activeTag]);

        // Helper to determine if a URL can be embedded
        const getEmbedUrl = (url) => {
            if (!url) return null;
            const fileIdMatch = url.match(/drive\.google\.com\/(?:file\/d\/|drive\/folders\/)([a-zA-Z0-9_-]+)/);
            // Ensure it's not a folder link, which can't be embedded this way
            if (url.includes('/folders/')) return null;
            return fileIdMatch ? `https://drive.google.com/file/d/${fileIdMatch[1]}/preview` : null;
        };

        return (
            <section id="resources" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800">
                {pdfToView && <PdfViewerModal pdfInfo={pdfToView} onClose={() => setPdfToView(null)} />}
                {showPaymentModal && <PaymentModal onPaymentSuccess={onPremiumUnlock} onClose={() => setShowPaymentModal(false)} userName={userName}/>}
                <div className="container mx-auto">
                    <h2 className="text-4xl font-extrabold text-center text-red-500 dark:text-red-400 mb-4 animate-fadeIn">Study Resources</h2>
                    <p className="text-center text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto mb-12">Your complete library for exam success.</p>
                    
                    {!isPremium ? (
                         <div className="text-center bg-gradient-to-r from-orange-500 to-amber-400 text-white p-6 rounded-2xl shadow-xl animate-popIn"><h4 className="text-3xl md:text-4xl font-extrabold mb-2">Unlock Your Full Potential!</h4><div className="max-w-2xl mx-auto mt-4 text-left space-y-2 px-4"><p className="flex items-start"><i className="fas fa-check-circle text-green-300 mt-1 mr-3"></i><span><strong>Full Access:</strong> Get all exclusive books, notes, and past papers.</span></p><p className="flex items-start"><i className="fas fa-check-circle text-green-300 mt-1 mr-3"></i><span><strong>Unlimited Quizzes:</strong> Unlock all premium quizzes instantly.</span></p><p className="flex items-start"><i className="fas fa-check-circle text-green-300 mt-1 mr-3"></i><span><strong>Downloadable Content:</strong> Download competition results and certificates.</span></p><p className="flex items-start"><i className="fas fa-check-circle text-green-300 mt-1 mr-3"></i><span><strong>One-Time Payment:</strong> Pay once, enjoy lifetime access.</span></p></div><div className="flex flex-col sm:flex-row justify-center items-center gap-4 mt-6"><a href={DATA.premiumInfoVideoLink} target="_blank" rel="noopener noreferrer" className="bg-white text-blue-700 font-bold py-3 px-8 rounded-full shadow-lg text-lg uppercase tracking-wide hover:bg-gray-100 transition-colors duration-300">What is this? <i className="fab fa-youtube ml-2"></i></a><button onClick={() => setShowPaymentModal(true)} className="gradient-button inline-block text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg uppercase tracking-wide">Get Premium Now <i className="fas fa-key ml-2"></i></button></div></div>
                    ) : (
                        <div className="text-center bg-gradient-to-r from-green-500 to-emerald-400 text-white p-6 rounded-2xl shadow-xl animate-popIn"><h4 className="text-3xl md:text-4xl font-extrabold mb-2">Premium Access Activated!</h4><p className="max-w-2xl mx-auto mt-4">You have full access to all resources. If you have any questions, feel free to reach out.</p><a href={questionWhatsAppLink} target="_blank" rel="noopener noreferrer" className="mt-6 inline-block bg-white text-green-700 font-bold py-3 px-8 rounded-full shadow-lg text-lg uppercase tracking-wide hover:bg-gray-100 transition-colors duration-300">Ask a Question <i className="fab fa-whatsapp ml-2"></i></a></div>
                    )}

                    <div className="sticky top-[80px] z-40 bg-gray-50/80 dark:bg-slate-800/80 backdrop-blur-sm p-4 my-8 rounded-xl shadow-md">
                        <div className="flex flex-col md:flex-row gap-4">
                            <div className="relative flex-grow">
                                <i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input type="text" placeholder="Search resources..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full pl-12 pr-4 py-3 rounded-full border-2 border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" />
                            </div>
                            <div className="flex-shrink-0 flex items-center gap-2 overflow-x-auto pb-2">
                                {allTags.map(tag => (
                                    <button key={tag} onClick={() => setActiveTag(tag)} className={`px-4 py-2 rounded-full font-semibold text-sm whitespace-nowrap transition-all ${activeTag === tag ? 'bg-indigo-600 text-white shadow' : 'bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600'}`}>
                                        {tag.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {filteredResources.length > 0 ? filteredResources.map((cat, idx) => {
                        const isPremiumCategory = cat.category === "Premium Materials";
                        const isLocked = !isPremium && isPremiumCategory && !trialState.isTrialActive;
                        return (
                            <div key={idx} className="mb-12">
                                <h3 className="text-3xl font-bold text-indigo-700 dark:text-indigo-300 mb-6 border-b-2 border-indigo-200 dark:border-indigo-800 pb-2">{cat.category}</h3>
                                <div className="relative">
                                    {isLocked && <PremiumLockOverlay onStartTrial={handleStartTrial} onUnlock={() => setShowPaymentModal(true)} hasUsedTrial={trialState.hasUsedTrial} isTrialActive={trialState.isTrialActive} timeLeft={trialState.timeLeft} />}
                                    <div className={`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 ${isLocked ? 'blur-sm pointer-events-none' : ''}`}>
                                        {cat.items.map((item, j) => {
                                            // *** THE FIX IS HERE ***
                                            // We check if the item is viewable, regardless of its category.
                                            const isViewable = !!getEmbedUrl(item.link);
                                            
                                            return (
                                                <div key={j} className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg card-hover animate-slideInUp" style={{animationDelay: `${j * 50}ms`}}>
                                                    <h4 className="flex items-start text-xl font-semibold text-gray-900 dark:text-white mb-4">
                                                        <i className={`${getIconForResource(item.tags)} mr-3 text-indigo-400 mt-1`}></i>
                                                        <span>{item.title}</span>
                                                    </h4>
                                                    
                                                    {isViewable ? (
                                                        // If it's viewable, show the secure viewer button.
                                                        <button 
                                                            onClick={() => setPdfToView({ url: item.link, title: item.title })} 
                                                            className="inline-block bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full shadow-md text-sm"
                                                            disabled={isLocked}
                                                        >
                                                            View Securely <i className="fas fa-eye ml-2"></i>
                                                        </button>
                                                    ) : (
                                                        // Otherwise, show the normal link.
                                                        <a 
                                                            href={item.link} 
                                                            target="_blank" 
                                                            rel="noopener noreferrer" 
                                                            className="inline-block gradient-button text-white font-bold py-2 px-4 rounded-full shadow-md text-sm"
                                                        >
                                                            Access / Download <i className="fas fa-external-link-alt ml-2"></i>
                                                        </a>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        )
                    }) : (
                        <div className="text-center py-16">
                            <p className="text-2xl font-bold">No resources found.</p>
                            <p className="text-gray-500 mt-2">Try adjusting your search or filter.</p>
                        </div>
                    )}
                </div>
            </section>
        );
    };
    const VideosSection = () => ( <section id="videos" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800"><div className="container mx-auto"><h2 className="text-4xl font-extrabold text-center text-red-500 dark:text-red-400 mb-10 animate-fadeIn">Informative Videos</h2><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{DATA.videos.map((video, idx) => (<div key={idx} className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg card-hover animate-slideInUp" style={{animationDelay: `${idx*100}ms`}}><h3 className="text-xl font-semibold text-gray-900 dark:text-white mb-3 flex items-start"><i className="fab fa-youtube text-red-500 mr-3 mt-1"></i><span>{video.title}</span></h3><a href={video.link} target="_blank" rel="noopener noreferrer" className="inline-block gradient-button text-white font-bold py-2 px-4 rounded-full shadow-md text-sm">Watch Video <i className="fas fa-play-circle ml-2"></i></a></div>))}</div></div></section> );
    const NoticeSection = ({ onAcknowledgeNotice }) => { useEffect(() => { onAcknowledgeNotice(); }, []); const typeColors = { Announcement: "border-blue-500", Update: "border-green-500", Important: "border-red-500" }; const typeIcons = { Announcement: "fas fa-bullhorn text-blue-500", Update: "fas fa-info-circle text-green-500", Important: "fas fa-exclamation-triangle text-red-500" }; return ( <section id="notices" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800"><div className="container mx-auto"><h2 className="text-4xl font-extrabold text-center text-red-500 dark:text-red-400 mb-10 animate-fadeIn">Portal Notices</h2><div className="space-y-6 max-w-4xl mx-auto">{DATA.notices.filter(n => !n.isCompulsory).map((notice, index) => (<div key={notice.id} className={`bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg border-l-4 card-hover animate-slideInUp ${typeColors[notice.type] || 'border-gray-500'}`} style={{ animationDelay: `${index * 100}ms` }}><div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2"><div className="flex items-center gap-3"><i className={`${typeIcons[notice.type] || 'fas fa-info-circle'} text-xl`}></i><h3 className="text-xl font-bold">{notice.title}</h3></div><p className="text-sm font-semibold text-gray-500 dark:text-gray-400 mt-2 sm:mt-0">{notice.date}</p></div><p className="mt-2 text-base leading-relaxed text-gray-600 dark:text-gray-300" dangerouslySetInnerHTML={{__html: notice.content}}></p></div>))}</div></div></section> ); };
     const FAQ_DATA = [
        { category: "Eligibility & General", items: [
            { question: "Who can apply for the scholarship?", answer: "Any student who passed SEE with at least 1.6 GPA from either a community or institutional school in Nepal. Priority is given to community school students, underrepresented groups, and those with financial need." },
            { question: "Do I need to be from Kathmandu, or can students from other districts apply?", answer: "Yes, students from all over Nepal can apply. However, priority is given to students studying in schools under Kathmandu Metropolitan City." },
            { question: "Is this exam the same as +2 college admission entrance exams?", answer: "No. This is a separate scholarship entrance exam conducted by Kathmandu Metropolitan City, not a general college admission exam." },
            { question: "What is the minimum GPA required in SEE to be eligible?", answer: "The minimum eligibility requirement is a GPA of 1.6 or above in the SEE examination." },
            { question: "Is there any age limit for applying?", answer: "No specific age limit is mentioned. The exam is primarily intended for recent SEE graduates applying for +2 (Science, Management, Humanities, or Law)." },
        ]},
        { category: "Application Process", items: [
            { question: "What documents do I need to apply?", answer: (<div><p>You need:</p><ul className="list-disc pl-5 space-y-1 mt-2"><li>SEE Admit Card & Marksheet</li><li>Passport-sized photo</li><li>Citizenship or birth certificate</li><li>School recommendation letter</li></ul></div>) },
            { question: "How do I apply online, and what if the portal doesn’t work?", answer: (<div><p>You must apply through <a href="https://entrance.kathmandu.gov.np" target="_blank" rel="noopener noreferrer" className="text-blue-500 hover:underline font-semibold">entrance.kathmandu.gov.np</a>. If the portal is slow, try during off-peak hours. For issues, contact the KMC Education Department.</p></div>) },
            { question: "Do I need to pay any fee to apply?", answer: "No, the application is completely free of cost." },
            { question: "Can I apply offline if I face issues online?", answer: "No. The process is fully online. There is no offline submission option." },
        ]},
        { category: "Exam Details", items: [
            { question: "What is the exam syllabus — Grade 10 only, or also Grade 11 topics?", answer: "The exam is strictly based on the Grade 10 (SEE) syllabus. No Grade 11 content is included." },
            { question: "How many questions are there, and how much time do we get?", answer: "There are 100 multiple-choice questions (MCQs). The duration of the exam is 2 hours." },
            { question: "Is there negative marking in the exam?", answer: "No, there is no negative marking. Wrong answers do not reduce your score." },
            { question: "Are calculators or mobile phones allowed during the exam?", answer: "No, electronic devices like calculators, smart watches, or mobile phones are not allowed inside the exam hall." },
        ]},
        { category: "Results & Scholarships", items: [
            { question: "How are results published, and how do I know if I’m selected?", answer: "Results are published as merit lists on the official KMC portal (kathmandu.gov.np). Students must check their roll number and rank to know if they are selected." },
            { question: "Does the scholarship cover all expenses (books, uniforms, hostel), or only tuition fees?", answer: "The scholarship covers full or partial tuition fees in affiliated colleges. It does not cover additional costs like books, uniforms, or hostel fees." },
        ]}
    ];

    const FAQsSection = () => {
        const [open, setOpen] = useState(null);
        const [searchTerm, setSearchTerm] = useState('');

        const filteredFaqs = useMemo(() => {
            if (!searchTerm.trim()) {
                return FAQ_DATA;
            }
            const lowercasedFilter = searchTerm.toLowerCase();
            
            return FAQ_DATA.map(category => {
                const filteredItems = category.items.filter(item => {
                    const questionMatches = item.question.toLowerCase().includes(lowercasedFilter);
                    
                    // --- FIX IS HERE ---
                    // Check if the answer is a string before trying to search it.
                    // This prevents the error when an answer is a React component (JSX).
                    let answerMatches = false;
                    if (typeof item.answer === 'string') {
                        answerMatches = item.answer.toLowerCase().includes(lowercasedFilter);
                    }

                    return questionMatches || answerMatches;
                });

                return { ...category, items: filteredItems };
            }).filter(category => category.items.length > 0);
        }, [searchTerm]);

        return (
            <section id="faqs" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800">
                <div className="container mx-auto">
                    <h2 className="text-4xl font-extrabold text-center text-red-500 dark:text-red-400 mb-10 animate-fadeIn">Frequently Asked Questions</h2>
                    
                    <div className="max-w-4xl mx-auto mb-8 relative">
                        <i className="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input 
                            type="text" 
                            placeholder="Search for a question..." 
                            value={searchTerm} 
                            onChange={e => setSearchTerm(e.target.value)} 
                            className="w-full pl-12 pr-4 py-3 rounded-full border-2 border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition" 
                        />
                    </div>

                    {filteredFaqs.length > 0 ? filteredFaqs.map((cat, ci) => (
                        <div key={ci} className="mb-8 max-w-4xl mx-auto">
                            <h3 className="text-3xl font-bold text-indigo-700 dark:text-indigo-300 mb-6 border-b-2 border-indigo-200 dark:border-indigo-800 pb-2">{cat.category}</h3>
                            <div className="space-y-4">
                                {cat.items.map((f, fi) => (
                                    <div key={fi} className="bg-white dark:bg-slate-900 rounded-2xl shadow-lg card-hover">
                                        <button 
                                            className="flex justify-between items-center w-full text-left text-lg font-semibold text-gray-900 dark:text-white p-6" 
                                            onClick={() => setOpen(open === `${ci}-${fi}` ? null : `${ci}-${fi}`)}
                                        >
                                            <span>{f.question}</span>
                                            <i className={`fas ${open === `${ci}-${fi}` ? 'fa-chevron-up' : 'fa-chevron-down'} text-indigo-500 transition-transform duration-300`}></i>
                                        </button>
                                        {open === `${ci}-${fi}` && (
                                            <div className="px-6 pb-6 text-gray-700 dark:text-gray-300 leading-relaxed animate-fadeIn">
                                                {f.answer}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )) : (
                        <div className="text-center py-10 max-w-4xl mx-auto">
                            <p className="text-xl font-semibold text-gray-700 dark:text-gray-300">No questions found matching your search.</p>
                            <p className="text-gray-500 mt-2">Please try a different keyword.</p>
                        </div>
                    )}
                </div>
            </section>
        );
    };

    const PremiumCertificate = ({ userName, onDownload }) => { const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }); const fixedLogoUrl = "https://i.ibb.co/3zdP15p/balen-logo-final.jpg"; return ( <div className="overlay"> <div className="modal-box bg-white dark:bg-slate-900 max-w-3xl w-full p-2 md:p-4"> <div id="certificate" className="bg-slate-900 text-gray-200 p-8 rounded-lg relative overflow-hidden shadow-2xl border-2 border-amber-400/30"> <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_rgba(255,255,255,0.1)_0%,_rgba(255,255,255,0)_70%)]"></div> <div className="relative z-10"> <div className="flex justify-between items-center pb-4 border-b-2 border-amber-400/50"> <div className="flex items-center gap-4"> <img src={fixedLogoUrl} alt="Portal Logo" className="h-16 w-16 rounded-full object-cover border-2 border-amber-300" /> <div> <h2 className="font-bold text-xl text-white tracking-wide">Balen Scholarship</h2> <p className="text-sm text-gray-400">Official Prep Portal</p> </div> </div> <div className="text-right"> <i className="fas fa-star text-3xl text-amber-400"></i> <p className="font-semibold text-amber-400 uppercase tracking-wider text-sm mt-1">Premium Member</p> </div> </div> <div className="text-center my-12"> <p className="text-lg text-gray-400">This certifies that</p> <h1 className="font-serif text-5xl md:text-6xl font-extrabold my-4 text-white"> {userName} </h1> <p className="text-lg text-gray-300">has been granted full <span className="font-bold text-amber-400">Premium Access</span> to all exclusive resources, quizzes, and features of the portal.</p> </div> <div className="flex justify-between items-end mt-12 pt-4 border-t-2 border-amber-400/50"> <div className="text-left"> <svg className="w-24 h-24 p-1 bg-white rounded-md" viewBox="0 0 256 256"> <path d="M128 256a128 128 0 100-256 128 128 0 000 256zM88 64v32H56V64h32zm112 0v32h-32V64h32zM88 128v-32H56v32h32zm32-32v32h-32v-32h32zm80 0v32h-32v-32h32zm-80 80v-32h-32v32h32zm-32-32v32H56v-32h32zm112 32v-32h-32v32h32zM88 192v-32H56v32h32zm32 0v32H88v-32h32zm-32 32v32H56v-32h32zm80-80v-32h-32v32h32zm-32 32v32h-32v-32h32zm32 32v-32h-32v32h32z" fill="#334155"/> </svg> <p className="text-xs text-gray-500 mt-1">Verification ID: BS-P-{userName.slice(0,2).toUpperCase()}2024</p> </div> <div className="text-center"> <p className="font-script text-4xl text-gray-100">Ganesh Dahal</p> <hr className="w-full border-t border-amber-400/50 mt-1" /> <p className="text-sm text-gray-400 mt-1">Portal Creator</p> <p className="text-xs text-gray-500">Issued on: {date}</p> </div> </div> </div> </div> <div className="text-center"> <button onClick={onDownload} className="gradient-button text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg mt-6">Download Certificate</button> </div> </div> </div> ); };
    const CompletionCertificate = ({ userName, onDownload }) => { const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }); const fixedLogoUrl = "https://i.ibb.co/3zdP15p/balen-logo-final.jpg"; const goldSealUrl = "https://i.ibb.co/T0f0d3j/gold-seal-embossed.png"; return ( <div className="overlay"> <div className="modal-box bg-white dark:bg-slate-900 max-w-5xl w-full p-6 md:p-10"> <div id="completion-certificate" className="relative bg-white text-slate-800 px-12 py-16 shadow-2xl overflow-hidden font-serif rounded-lg"> <div className="absolute inset-0 z-0"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800" preserveAspectRatio="none" className="w-full h-full"> <path d="M0,120 C300,240 900,0 1200,120 L1200,800 L0,800 Z" fill="#ff7e29" opacity="0.85" /> <path d="M0,240 C300,360 900,120 1200,240 L1200,800 L0,800 Z" fill="#ffa31a" opacity="0.85" /> </svg> </div> <div className="relative z-10 text-center flex flex-col items-center space-y-6"> <img src={fixedLogoUrl} alt="Logo" className="h-24 w-24 rounded-full object-cover border-4 border-white shadow-md" /> <h1 className="font-serif text-4xl md:text-5xl font-bold text-slate-900 tracking-wider uppercase"> Certificate of Completion </h1> <p className="text-lg md:text-xl text-slate-600 font-sans"> Balen Scholarship Preparatory Program </p> <p className="mt-6 text-xl text-slate-600 font-sans italic"> This acknowledges that </p> <p className="font-[cursive] text-5xl md:text-7xl font-bold text-slate-900 tracking-wide leading-tight break-words px-4"> {userName} </p> <div className="max-w-3xl mx-auto text-center font-sans text-base md:text-lg text-slate-700 leading-relaxed px-4"> <p> has successfully completed the <strong>Balen Scholarship Preparatory Program</strong>. </p> <p className="mt-3"> Your dedication, perseverance, and commitment to learning are highly commendable. May this achievement inspire greater success in the future. </p> </div> <div className="flex flex-col md:flex-row justify-between items-center mt-14 w-full max-w-4xl mx-auto gap-y-10 md:gap-y-0"> <div className="text-center"> <p className="font-[cursive] text-3xl md:text-4xl text-slate-900 -mb-1">Ganesh Dahal</p> <hr className="w-52 md:w-64 border-t-2 border-slate-500/70 mx-auto" /> <p className="text-sm text-slate-600 mt-1 font-sans tracking-widest">PROGRAM DIRECTOR</p> </div> <div className="text-center"> <p className="font-sans font-semibold text-base md:text-lg text-slate-800">{date}</p> <hr className="w-52 md:w-64 border-t-2 border-slate-500/70 mx-auto" /> <p className="text-sm text-slate-600 mt-1 font-sans tracking-widest">AWARDED ON</p> </div> </div> <img src={goldSealUrl} alt="Official Seal" className="absolute bottom-10 right-10 w-28 md:w-32 h-28 md:h-32 z-20 drop-shadow-xl" /> </div> </div> <div className="text-center"> <button onClick={() => onDownload('completion-certificate')} className="bg-gradient-to-r from-orange-600 to-yellow-500 text-white font-bold py-3 px-10 rounded-full shadow-lg text-lg mt-6 hover:scale-105 transition-transform" > Download Certificate </button> </div> </div> </div> ); };
    
    // =================================================================================
    // ===== MAIN APP COMPONENT =====
    // =================================================================================
    const App = () => {
        const [isLoading, setIsLoading] = useState(true);
        const [isNameSet, setIsNameSet] = useState(false);
        const [activeSection, setActiveSection] = useState('home');
        const [userName, setUserName] = useState('');
        const [isPremium, setIsPremium] = useState(false);
        const [userStats, setUserStats] = useState({ xp: 0, streak: 0, freezes: 1, name: '' });
        const [completedQuizzes, setCompletedQuizzes] = useState({});
        const [unlockedAchievements, setUnlockedAchievements] = useState({});
        const [activityLog, setActivityLog] = useState([]);
        const [toastQueue, setToastQueue] = useState([]);
        const [showPremiumCertModal, setShowPremiumCertModal] = useState(false);
        const [showCompletionCertModal, setShowCompletionCertModal] = useState(false);
        const [showCelebrationModal, setShowCelebrationModal] = useState(false);
        const [hasNewNotice, setHasNewNotice] = useState(false);
        const [compulsoryNotice, setCompulsoryNotice] = useState(null);
        const [forceRefresh, setForceRefresh] = useState(0);

        const logActivity = (message) => { const log = getJSONFromLocalStorage('activityLog', []); log.unshift(message); const newLog = log.slice(0, 5); localStorage.setItem('activityLog', JSON.stringify(newLog)); setActivityLog(newLog); };
        const checkAndUnlockAchievement = (achievementId) => {
            const currentAchievements = getJSONFromLocalStorage('unlockedAchievements', {});
            if (!currentAchievements[achievementId]) {
                const achievement = DATA.achievementsList[achievementId];
                const newAchievements = { ...currentAchievements, [achievementId]: true };
                setUnlockedAchievements(newAchievements);
                localStorage.setItem('unlockedAchievements', JSON.stringify(newAchievements));
                setToastQueue(prev => [...prev, achievement]);
                logActivity(`Unlocked: '${achievement.title}'`);
            }
        };

        useEffect(() => {
            const storedName = localStorage.getItem('balenUserName');
            if(storedName) {
                setUserName(storedName); setIsNameSet(true); setIsPremium(localStorage.getItem('balenPremiumUnlocked') === 'true');
                setUserStats(getJSONFromLocalStorage('balenUserStats', { xp: 0, streak: 0, freezes: 1, name: storedName }));
                setCompletedQuizzes(getJSONFromLocalStorage('balenCompletedQuizzes', {}));
                setUnlockedAchievements(getJSONFromLocalStorage('unlockedAchievements', {}));
                setActivityLog(getJSONFromLocalStorage('activityLog', []));
                
                const latestNormalNotice = DATA.notices.find(n => !n.isCompulsory);
                const lastSeenNoticeId = getJSONFromLocalStorage('lastSeenNoticeId', 0);
                if (latestNormalNotice && latestNormalNotice.id > lastSeenNoticeId) { setHasNewNotice(true); }

                const latestCompulsory = DATA.notices.find(n => n.isCompulsory);
                const acknowledgedId = getJSONFromLocalStorage('acknowledgedCompulsoryNoticeId', 0);
                if (latestCompulsory && latestCompulsory.id > acknowledgedId) { setCompulsoryNotice(latestCompulsory); }

                const today = new Date().toDateString();
                const lastLogin = localStorage.getItem('balenLastLogin');
                if (lastLogin !== today) {
                    const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                    setUserStats(prev => {
                        let newStreak = (lastLogin === yesterday.toDateString()) ? prev.streak + 1 : 1;
                        const newStats = { ...prev, streak: newStreak };
                        localStorage.setItem('balenUserStats', JSON.stringify(newStats));
                        if (newStreak >= 7) checkAndUnlockAchievement('STREAK_7');
                        if (newStreak >= 14) checkAndUnlockAchievement('STREAK_14');
                        if (newStreak >= 30) checkAndUnlockAchievement('STREAK_30');
                        let unlockedByStreak = 0; for (const day in DATA.STREAK_UNLOCKS) { if (newStreak >= parseInt(day, 10)) { unlockedByStreak = Math.max(unlockedByStreak, DATA.STREAK_UNLOCKS[day]); } }
                        const currentUnlocks = getJSONFromLocalStorage('balenQuizUnlocks', {});
                        localStorage.setItem('balenQuizUnlocks', JSON.stringify({...currentUnlocks, unlockedByStreak, dailyUnlocks: 0}));
                        return newStats;
                    });
                    localStorage.setItem('balenLastLogin', today);
                }
            }
            setTimeout(() => setIsLoading(false), 1500);
        }, [isNameSet, forceRefresh]);

        const handleNameSet = (name) => {
            localStorage.clear();
            localStorage.setItem('balenUserName', name);
            const initialStats = { xp: 0, streak: 1, freezes: 1, name: name };
            localStorage.setItem('balenUserStats', JSON.stringify(initialStats));
            localStorage.setItem('balenLastLogin', new Date().toDateString());
            setUserName(name); setUserStats(initialStats); setIsNameSet(true);
        };
        
        const handlePremiumUnlock = () => { setIsPremium(true); localStorage.setItem('balenPremiumUnlocked', 'true'); checkAndUnlockAchievement('PREMIUM_USER'); setShowPremiumCertModal(true); logActivity('Unlocked Premium Access!'); };
        const handleQuizComplete = (quizDay) => { const currentCompleted = getJSONFromLocalStorage('balenCompletedQuizzes', {}); if (currentCompleted[quizDay]) return; const newCompleted = { ...currentCompleted, [quizDay]: true }; const quizTitle = DATA.dailyQuizzes.find(q=>q.day === quizDay)?.title || `Quiz ${quizDay}`; logActivity(`Completed: '${quizTitle}'`); setCompletedQuizzes(newCompleted); localStorage.setItem('balenCompletedQuizzes', JSON.stringify(newCompleted)); setUserStats(prev => { const xpBonus = prev.streak >= 5 ? DATA.XP_PER_QUIZ : 0; const newStats = { ...prev, xp: prev.xp + DATA.XP_PER_QUIZ + xpBonus }; localStorage.setItem('balenUserStats', JSON.stringify(newStats)); return newStats; }); const completedCount = Object.keys(newCompleted).length; if (completedCount === 1) checkAndUnlockAchievement('FIRST_QUIZ'); if (completedCount === DATA.dailyQuizzes.length) { checkAndUnlockAchievement('ALL_QUIZZES'); setShowCelebrationModal(true); } setForceRefresh(c=>c+1); };
        const handleBrainBreakComplete = () => { setUserStats(prev => { const newStats = { ...prev, xp: prev.xp + DATA.XP_PER_BRAIN_BREAK }; localStorage.setItem('balenUserStats', JSON.stringify(newStats)); return newStats; }); };
        const handleDownloadCertificate = (id) => { const element = document.getElementById(id); if(element) { html2canvas(element, {backgroundColor: '#1e293b', useCORS: true}).then(canvas => { const link = document.createElement('a'); link.download = `${id}_${userName}.png`; link.href = canvas.toDataURL('image/png'); link.click(); }); } setShowPremiumCertModal(false); setShowCompletionCertModal(false); };

        const renderSection = () => {
            switch(activeSection) {
                case 'home': return <HomeDashboard setActiveSection={setActiveSection} userName={userName} completedQuizzes={completedQuizzes} userStats={userStats} isPremium={isPremium} activityLog={activityLog} />;
                case 'quizzes': return <QuizzesSection isPremium={isPremium} completedQuizzes={completedQuizzes} userStats={userStats} onQuizComplete={handleQuizComplete} onPremiumUnlock={handlePremiumUnlock} onStateRefresh={() => setForceRefresh(c=>c+1)} />;
                case 'competition': return <QuizCompetitionSection isPremium={isPremium} onSetUserName={(name) => {if (name) { setUserName(name); localStorage.setItem('balenUserName', name); setUserStats(s => ({...s, name}));}}} unlockedAchievements={unlockedAchievements} checkAndUnlockAchievement={checkAndUnlockAchievement} onShowPremiumCert={() => setShowPremiumCertModal(true)} onShowCompletionCert={() => setShowCompletionCertModal(true)} />;
                case 'resources': return <ResourcesSection isPremium={isPremium} onPremiumUnlock={handlePremiumUnlock} userName={userName} />;
                case 'entertainment': return <EntertainmentSection onBrainBreakComplete={handleBrainBreakComplete} checkAndUnlockAchievement={checkAndUnlockAchievement} />;
                case 'videos': return <VideosSection />;
                case 'notices': return <NoticeSection onAcknowledgeNotice={() => {setHasNewNotice(false); const latestNormal = DATA.notices.find(n => !n.isCompulsory); if(latestNormal) localStorage.setItem('lastSeenNoticeId', latestNormal.id);}} />;
                case 'faqs': return <FAQsSection />;
                default: return <HomeDashboard />;
            }
        };

        if (isLoading) return <AppLoader />;
        if (!isNameSet) return <NameEntryScreen onNameSet={handleNameSet} />;

        return (
            <Fragment>
                {compulsoryNotice && <CompulsoryNoticeModal notice={compulsoryNotice} onClose={() => { setCompulsoryNotice(null); localStorage.setItem('acknowledgedCompulsoryNoticeId', compulsoryNotice.id); }} />}
                {showPremiumCertModal && <PremiumCertificate userName={userName} onDownload={() => handleDownloadCertificate('certificate')} />}
                {showCelebrationModal && <CourseCompletionCelebration userName={userName} onViewCertificate={() => { setShowCelebrationModal(false); setShowCompletionCertModal(true); }} />}
                {showCompletionCertModal && <CompletionCertificate userName={userName} onDownload={() => handleDownloadCertificate('completion-certificate')} />}
                <Header setActiveSection={setActiveSection} activeSection={activeSection} isPremium={isPremium} userStats={userStats} hasNewNotice={hasNewNotice} />
                <main>{renderSection()}</main>
                <Footer />
                {toastQueue[0] && <AchievementToast achievement={toastQueue[0]} onDismiss={() => setToastQueue(q => q.slice(1))} />}
            </Fragment>
        );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
